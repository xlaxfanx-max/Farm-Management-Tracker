# Generated by Django 4.2 on 2026-01-19 22:17

import api.models
from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0024_alter_tree_options_alter_treeobservation_options_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='ComplianceDeadline',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200)),
                ('description', models.TextField(blank=True)),
                ('category', models.CharField(choices=[('reporting', 'Regulatory Reporting'), ('training', 'Training/Certification'), ('testing', 'Testing/Sampling'), ('documentation', 'Documentation'), ('inspection', 'Inspection'), ('renewal', 'License/Certificate Renewal'), ('audit', 'Audit'), ('other', 'Other')], max_length=50)),
                ('regulation', models.CharField(blank=True, help_text="Regulatory framework (e.g., 'CA PUR', 'EPA WPS', 'USDA NOP')", max_length=100)),
                ('due_date', models.DateField()),
                ('frequency', models.CharField(choices=[('once', 'One-time'), ('daily', 'Daily'), ('weekly', 'Weekly'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('semi_annual', 'Semi-Annual'), ('annual', 'Annual')], default='once', max_length=20)),
                ('warning_days', models.IntegerField(default=14, help_text='Days before due date to start showing warnings')),
                ('status', models.CharField(choices=[('upcoming', 'Upcoming'), ('due_soon', 'Due Soon'), ('overdue', 'Overdue'), ('completed', 'Completed'), ('skipped', 'Skipped/N/A')], default='upcoming', max_length=20)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True)),
                ('auto_generated', models.BooleanField(default=False, help_text='Was this deadline auto-generated from compliance profile?')),
                ('action_url', models.CharField(blank=True, help_text="Frontend route to complete this task (e.g., '/reports/pur')", max_length=200)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_deadlines', to='api.company')),
                ('completed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='completed_deadlines', to=settings.AUTH_USER_MODEL)),
                ('related_farm', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='compliance_deadlines', to='api.farm')),
                ('related_field', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='compliance_deadlines', to='api.field')),
                ('source_deadline', models.ForeignKey(blank=True, help_text='Parent deadline for recurring deadlines', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='recurring_instances', to='api.compliancedeadline')),
            ],
            options={
                'verbose_name': 'Compliance Deadline',
                'verbose_name_plural': 'Compliance Deadlines',
                'ordering': ['due_date', 'name'],
            },
        ),
        migrations.CreateModel(
            name='WPSTrainingRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('trainee_name', models.CharField(max_length=200)),
                ('trainee_employee_id', models.CharField(blank=True, help_text='Internal employee ID if applicable', max_length=50)),
                ('training_type', models.CharField(choices=[('pesticide_safety', 'Pesticide Safety Training (Workers)'), ('handler', 'Handler Training'), ('early_entry', 'Early Entry Training'), ('respirator', 'Respirator Fit Test'), ('heat_illness', 'Heat Illness Prevention'), ('emergency_response', 'Emergency Response'), ('ppe', 'Personal Protective Equipment'), ('first_aid', 'First Aid/CPR')], max_length=50)),
                ('training_date', models.DateField()),
                ('expiration_date', models.DateField()),
                ('training_program', models.CharField(blank=True, help_text='Name of training program/curriculum used', max_length=200)),
                ('training_language', models.CharField(default='English', help_text='Language training was conducted in', max_length=50)),
                ('trainer_name', models.CharField(max_length=200)),
                ('trainer_certification', models.CharField(blank=True, help_text="Trainer's certification number", max_length=100)),
                ('verified', models.BooleanField(default=False, help_text='Trainee comprehension verified')),
                ('verification_method', models.CharField(blank=True, help_text="How comprehension was verified (e.g., 'Quiz - 85%', 'Verbal')", max_length=100)),
                ('quiz_score', models.IntegerField(blank=True, help_text='Quiz score if applicable (percentage)', null=True)),
                ('certificate_document', models.FileField(blank=True, help_text='Scanned training certificate', null=True, upload_to='wps_training/%Y/%m/')),
                ('training_location', models.CharField(blank=True, help_text='Where training was conducted', max_length=200)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='wps_training_records', to='api.company')),
                ('farm', models.ForeignKey(blank=True, help_text='Farm where training was conducted if applicable', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='wps_training_records', to='api.farm')),
                ('trainee_user', models.ForeignKey(blank=True, help_text='Link to user account if trainee is a system user', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='wps_training_received', to=settings.AUTH_USER_MODEL)),
                ('trainer_user', models.ForeignKey(blank=True, help_text="Link to trainer's user account if internal", null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='wps_training_given', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'WPS Training Record',
                'verbose_name_plural': 'WPS Training Records',
                'ordering': ['-training_date'],
            },
        ),
        migrations.CreateModel(
            name='REIPostingRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('rei_hours', models.PositiveIntegerField(help_text='Restricted Entry Interval in hours')),
                ('rei_end_datetime', models.DateTimeField(help_text='When REI expires and field can be re-entered')),
                ('posted_at', models.DateTimeField(blank=True, help_text='When warning signs were posted', null=True)),
                ('removed_at', models.DateTimeField(blank=True, help_text='When warning signs were removed', null=True)),
                ('posting_compliant', models.BooleanField(default=False, help_text='Signs posted before/during application')),
                ('removal_compliant', models.BooleanField(default=False, help_text='Signs removed only after REI expired')),
                ('early_entry_occurred', models.BooleanField(default=False, help_text='Workers entered during REI')),
                ('early_entry_reason', models.TextField(blank=True, help_text='Reason for early entry if applicable')),
                ('early_entry_ppe', models.TextField(blank=True, help_text='PPE worn during early entry')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('application', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='rei_posting', to='api.pesticideapplication')),
                ('posted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rei_postings', to=settings.AUTH_USER_MODEL)),
                ('removed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rei_removals', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'REI Posting Record',
                'verbose_name_plural': 'REI Posting Records',
                'ordering': ['-rei_end_datetime'],
            },
        ),
        migrations.CreateModel(
            name='NotificationPreference',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('email_enabled', models.BooleanField(default=True, help_text='Receive email notifications')),
                ('email_digest_frequency', models.CharField(choices=[('instant', 'Instant (As they occur)'), ('daily', 'Daily Digest'), ('weekly', 'Weekly Digest'), ('none', 'No Email (In-app only)')], default='instant', max_length=20)),
                ('notify_deadlines', models.BooleanField(default=True, help_text='Compliance deadline reminders')),
                ('notify_licenses', models.BooleanField(default=True, help_text='License expiration warnings')),
                ('notify_training', models.BooleanField(default=True, help_text='Training renewal reminders')),
                ('notify_reports', models.BooleanField(default=True, help_text='Report generation and submission notifications')),
                ('notify_incidents', models.BooleanField(default=True, help_text='Incident report notifications')),
                ('notify_rei', models.BooleanField(default=True, help_text='REI posting and expiration reminders')),
                ('deadline_reminder_days', models.JSONField(default=api.models.default_deadline_reminder_days, help_text='Days before deadline to send reminders')),
                ('license_reminder_days', models.JSONField(default=api.models.default_license_reminder_days, help_text='Days before license expiration to send reminders')),
                ('quiet_hours_enabled', models.BooleanField(default=False)),
                ('quiet_hours_start', models.TimeField(blank=True, help_text='Start of quiet hours (e.g., 21:00)', null=True)),
                ('quiet_hours_end', models.TimeField(blank=True, help_text='End of quiet hours (e.g., 07:00)', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='notification_preferences', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Notification Preference',
                'verbose_name_plural': 'Notification Preferences',
            },
        ),
        migrations.CreateModel(
            name='NotificationLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('notification_type', models.CharField(help_text="Type of notification (e.g., 'deadline_reminder', 'license_expiring')", max_length=50)),
                ('channel', models.CharField(choices=[('email', 'Email'), ('in_app', 'In-App'), ('sms', 'SMS')], max_length=20)),
                ('subject', models.CharField(max_length=200)),
                ('message', models.TextField()),
                ('sent_at', models.DateTimeField(auto_now_add=True)),
                ('delivered', models.BooleanField(default=False)),
                ('delivery_error', models.TextField(blank=True)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('related_object_type', models.CharField(blank=True, max_length=50)),
                ('related_object_id', models.IntegerField(blank=True, null=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notification_logs', to='api.company')),
                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='notification_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Notification Log',
                'verbose_name_plural': 'Notification Logs',
                'ordering': ['-sent_at'],
            },
        ),
        migrations.CreateModel(
            name='License',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('license_type', models.CharField(choices=[('qal', 'Qualified Applicator License (QAL)'), ('qac', 'Qualified Applicator Certificate (QAC)'), ('pca', 'Pest Control Advisor (PCA)'), ('pilots_license', "Pilot's License (Aerial Application)"), ('structural', 'Structural Pest Control'), ('cdl', "Commercial Driver's License (CDL)"), ('organic_handler', 'Organic Handler Certificate'), ('food_safety', 'Food Safety Certificate'), ('wps_trainer', 'WPS Trainer Certification'), ('haccp', 'HACCP Certification'), ('gap_auditor', 'GAP Auditor Certification'), ('other', 'Other')], max_length=50)),
                ('license_number', models.CharField(max_length=100)),
                ('name_on_license', models.CharField(blank=True, help_text='Name as it appears on the license', max_length=200)),
                ('issuing_authority', models.CharField(help_text="Issuing agency (e.g., 'CA DPR', 'CDFA', 'USDA')", max_length=200)),
                ('issuing_state', models.CharField(blank=True, help_text='State that issued the license', max_length=2)),
                ('issue_date', models.DateField()),
                ('expiration_date', models.DateField()),
                ('status', models.CharField(choices=[('active', 'Active'), ('expiring_soon', 'Expiring Soon'), ('expired', 'Expired'), ('suspended', 'Suspended'), ('pending_renewal', 'Pending Renewal')], default='active', max_length=20)),
                ('categories', models.JSONField(blank=True, default=list, help_text="License categories (e.g., ['A', 'B', 'C'] for applicator)")),
                ('endorsements', models.JSONField(blank=True, default=list, help_text='Special endorsements')),
                ('renewal_reminder_days', models.IntegerField(default=90, help_text='Days before expiration to start reminding')),
                ('renewal_in_progress', models.BooleanField(default=False)),
                ('renewal_submitted_date', models.DateField(blank=True, null=True)),
                ('renewal_notes', models.TextField(blank=True)),
                ('ce_credits_required', models.IntegerField(blank=True, help_text='CE credits required per renewal period', null=True)),
                ('ce_credits_earned', models.IntegerField(blank=True, help_text='CE credits earned toward next renewal', null=True)),
                ('document', models.FileField(blank=True, help_text='Scanned copy of license', null=True, upload_to='licenses/%Y/%m/')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='licenses', to='api.company')),
                ('user', models.ForeignKey(blank=True, help_text='Leave blank for company-level licenses', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='licenses', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'License',
                'verbose_name_plural': 'Licenses',
                'ordering': ['expiration_date'],
            },
        ),
        migrations.CreateModel(
            name='IncidentReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('incident_type', models.CharField(choices=[('exposure', 'Pesticide Exposure'), ('spill', 'Chemical Spill'), ('equipment', 'Equipment Failure'), ('injury', 'Injury'), ('near_miss', 'Near Miss'), ('environmental', 'Environmental Release'), ('property', 'Property Damage'), ('drift', 'Pesticide Drift'), ('other', 'Other')], max_length=50)),
                ('severity', models.CharField(choices=[('minor', 'Minor'), ('moderate', 'Moderate'), ('serious', 'Serious'), ('critical', 'Critical')], max_length=20)),
                ('incident_date', models.DateTimeField()),
                ('reported_date', models.DateTimeField(auto_now_add=True)),
                ('location_description', models.CharField(blank=True, help_text='Specific location description', max_length=200)),
                ('affected_persons', models.JSONField(default=list, help_text='List of affected persons: [{name, role, injuries}]')),
                ('witnesses', models.JSONField(default=list, help_text='List of witnesses: [{name, contact}]')),
                ('title', models.CharField(max_length=200)),
                ('description', models.TextField()),
                ('immediate_actions', models.TextField(blank=True, help_text='Actions taken immediately after incident')),
                ('products_involved', models.JSONField(default=list, help_text='List of products involved: [{name, epa_reg, amount}]')),
                ('status', models.CharField(choices=[('reported', 'Reported'), ('investigating', 'Under Investigation'), ('corrective_action', 'Corrective Action in Progress'), ('resolved', 'Resolved'), ('closed', 'Closed')], default='reported', max_length=20)),
                ('root_cause', models.TextField(blank=True)),
                ('contributing_factors', models.JSONField(default=list, help_text='List of contributing factors')),
                ('corrective_actions', models.TextField(blank=True)),
                ('preventive_measures', models.TextField(blank=True)),
                ('reported_to_authorities', models.BooleanField(default=False)),
                ('authority_name', models.CharField(blank=True, help_text='Agency reported to', max_length=200)),
                ('authority_report_date', models.DateField(blank=True, null=True)),
                ('authority_report_reference', models.CharField(blank=True, help_text='Report/case number', max_length=100)),
                ('resolved_date', models.DateField(blank=True, null=True)),
                ('resolution_summary', models.TextField(blank=True)),
                ('documents', models.JSONField(default=list, help_text='List of attached document paths')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='incident_reports', to='api.company')),
                ('farm', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incident_reports', to='api.farm')),
                ('field', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incident_reports', to='api.field')),
                ('investigator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incidents_investigating', to=settings.AUTH_USER_MODEL)),
                ('related_application', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incident_reports', to='api.pesticideapplication')),
                ('reported_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incidents_reported', to=settings.AUTH_USER_MODEL)),
                ('resolved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='incidents_resolved', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Incident Report',
                'verbose_name_plural': 'Incident Reports',
                'ordering': ['-incident_date'],
            },
        ),
        migrations.CreateModel(
            name='ComplianceReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('report_type', models.CharField(choices=[('pur_monthly', 'PUR Monthly Report'), ('pur_annual', 'PUR Annual Summary'), ('sgma_semi_annual', 'SGMA Semi-Annual Report'), ('ilrp_annual', 'ILRP Annual Report'), ('wps_annual', 'WPS Training Summary'), ('organic_annual', 'Organic Certification Report'), ('globalgap_audit', 'GlobalGAP Audit Package'), ('custom', 'Custom Report')], max_length=50)),
                ('title', models.CharField(max_length=200)),
                ('reporting_period_start', models.DateField()),
                ('reporting_period_end', models.DateField()),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending_review', 'Pending Review'), ('ready', 'Ready for Submission'), ('submitted', 'Submitted'), ('accepted', 'Accepted'), ('rejected', 'Rejected - Needs Correction')], default='draft', max_length=20)),
                ('report_data', models.JSONField(default=dict, help_text='Pre-computed report data in JSON format')),
                ('record_count', models.IntegerField(default=0, help_text='Number of records included in report')),
                ('report_file', models.FileField(blank=True, help_text='Generated report file (PDF/Excel/CSV)', null=True, upload_to='compliance_reports/%Y/%m/')),
                ('validation_run_at', models.DateTimeField(blank=True, null=True)),
                ('validation_errors', models.JSONField(default=list, help_text='List of validation errors')),
                ('validation_warnings', models.JSONField(default=list, help_text='List of validation warnings')),
                ('is_valid', models.BooleanField(default=False, help_text='Passed validation with no errors')),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('submission_method', models.CharField(blank=True, help_text="How submitted (e.g., 'CalAgPermits', 'Email', 'Mail')", max_length=50)),
                ('submission_reference', models.CharField(blank=True, help_text='Confirmation number or reference', max_length=100)),
                ('response_received_at', models.DateTimeField(blank=True, null=True)),
                ('response_notes', models.TextField(blank=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_reports', to='api.company')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_reports', to=settings.AUTH_USER_MODEL)),
                ('related_deadline', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reports', to='api.compliancedeadline')),
                ('submitted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='submitted_reports', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Compliance Report',
                'verbose_name_plural': 'Compliance Reports',
                'ordering': ['-reporting_period_end', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ComplianceProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('primary_state', models.CharField(choices=[('AL', 'Alabama'), ('AK', 'Alaska'), ('AZ', 'Arizona'), ('AR', 'Arkansas'), ('CA', 'California'), ('CO', 'Colorado'), ('CT', 'Connecticut'), ('DE', 'Delaware'), ('FL', 'Florida'), ('GA', 'Georgia'), ('HI', 'Hawaii'), ('ID', 'Idaho'), ('IL', 'Illinois'), ('IN', 'Indiana'), ('IA', 'Iowa'), ('KS', 'Kansas'), ('KY', 'Kentucky'), ('LA', 'Louisiana'), ('ME', 'Maine'), ('MD', 'Maryland'), ('MA', 'Massachusetts'), ('MI', 'Michigan'), ('MN', 'Minnesota'), ('MS', 'Mississippi'), ('MO', 'Missouri'), ('MT', 'Montana'), ('NE', 'Nebraska'), ('NV', 'Nevada'), ('NH', 'New Hampshire'), ('NJ', 'New Jersey'), ('NM', 'New Mexico'), ('NY', 'New York'), ('NC', 'North Carolina'), ('ND', 'North Dakota'), ('OH', 'Ohio'), ('OK', 'Oklahoma'), ('OR', 'Oregon'), ('PA', 'Pennsylvania'), ('RI', 'Rhode Island'), ('SC', 'South Carolina'), ('SD', 'South Dakota'), ('TN', 'Tennessee'), ('TX', 'Texas'), ('UT', 'Utah'), ('VT', 'Vermont'), ('VA', 'Virginia'), ('WA', 'Washington'), ('WV', 'West Virginia'), ('WI', 'Wisconsin'), ('WY', 'Wyoming')], default='CA', help_text='Primary state of operation - determines default regulations', max_length=2)),
                ('additional_states', models.JSONField(blank=True, default=list, help_text='Additional states where operations occur (list of state codes)')),
                ('requires_pur_reporting', models.BooleanField(default=True, help_text='Pesticide Use Reports to County Ag Commissioner (CA only)', verbose_name='California PUR Reporting')),
                ('requires_wps_compliance', models.BooleanField(default=True, help_text='EPA WPS training, posting, and recordkeeping', verbose_name='Worker Protection Standard')),
                ('requires_fsma_compliance', models.BooleanField(default=False, help_text='FDA Food Safety Modernization Act requirements', verbose_name='FSMA Produce Safety Rule')),
                ('requires_sgma_reporting', models.BooleanField(default=False, help_text='Sustainable Groundwater Management Act (CA)', verbose_name='SGMA Groundwater Reporting')),
                ('requires_ilrp_reporting', models.BooleanField(default=False, help_text='Irrigated Lands Regulatory Program (CA)', verbose_name='ILRP Nitrogen Reporting')),
                ('organic_certified', models.BooleanField(default=False, help_text='USDA NOP Organic Certification')),
                ('organic_certifier', models.CharField(blank=True, help_text='Certifying agency (e.g., CCOF, Oregon Tilth)', max_length=100)),
                ('globalgap_certified', models.BooleanField(default=False, help_text='GlobalGAP Certification')),
                ('primus_certified', models.BooleanField(default=False, help_text='PrimusGFS Certification')),
                ('sqf_certified', models.BooleanField(default=False, help_text='Safe Quality Food Certification')),
                ('buyer_requirements', models.JSONField(blank=True, default=dict, help_text='Custom buyer requirements: {buyer_name: {requirement_key: value}}')),
                ('deadline_reminder_days', models.JSONField(default=api.models.default_deadline_reminder_days, help_text='Days before deadline to send reminders')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_profile', to='api.company')),
            ],
            options={
                'verbose_name': 'Compliance Profile',
                'verbose_name_plural': 'Compliance Profiles',
            },
        ),
        migrations.CreateModel(
            name='ComplianceAlert',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('alert_type', models.CharField(choices=[('deadline_approaching', 'Deadline Approaching'), ('deadline_overdue', 'Deadline Overdue'), ('license_expiring', 'License/Certificate Expiring'), ('license_expired', 'License/Certificate Expired'), ('training_due', 'Training Due'), ('training_expired', 'Training Expired'), ('phi_violation', 'PHI Violation Risk'), ('rei_violation', 'REI Violation Risk'), ('missing_documentation', 'Missing Documentation'), ('test_overdue', 'Test Overdue'), ('report_ready', 'Report Ready for Submission'), ('audit_upcoming', 'Audit Upcoming'), ('certification_expiring', 'Certification Expiring')], max_length=50)),
                ('priority', models.CharField(choices=[('critical', 'Critical'), ('high', 'High'), ('medium', 'Medium'), ('low', 'Low')], max_length=20)),
                ('title', models.CharField(max_length=200)),
                ('message', models.TextField()),
                ('related_object_type', models.CharField(blank=True, help_text="Model name of related object (e.g., 'License', 'WPSTrainingRecord')", max_length=50)),
                ('related_object_id', models.IntegerField(blank=True, help_text='ID of the related object', null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('is_acknowledged', models.BooleanField(default=False)),
                ('acknowledged_at', models.DateTimeField(blank=True, null=True)),
                ('action_url', models.CharField(blank=True, help_text='Frontend route to resolve this alert', max_length=200)),
                ('action_label', models.CharField(blank=True, help_text="Button label for action (e.g., 'Submit Report', 'Renew License')", max_length=100)),
                ('expires_at', models.DateTimeField(blank=True, help_text='Auto-dismiss alert after this time', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('acknowledged_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='acknowledged_alerts', to=settings.AUTH_USER_MODEL)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='compliance_alerts', to='api.company')),
                ('related_deadline', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='alerts', to='api.compliancedeadline')),
            ],
            options={
                'verbose_name': 'Compliance Alert',
                'verbose_name_plural': 'Compliance Alerts',
                'ordering': ['-priority', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='CentralPostingLocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('location_name', models.CharField(help_text="Name of posting location (e.g., 'Main Break Room')", max_length=200)),
                ('location_description', models.TextField(blank=True, help_text='Detailed description of location')),
                ('has_wps_poster', models.BooleanField(default=False, help_text='EPA WPS safety poster displayed', verbose_name='WPS Safety Poster')),
                ('has_emergency_info', models.BooleanField(default=False, help_text='Emergency medical facility location and phone number posted', verbose_name='Emergency Information')),
                ('has_sds_available', models.BooleanField(default=False, help_text='SDSs for all pesticides used in last 30 days accessible', verbose_name='Safety Data Sheets')),
                ('has_application_info', models.BooleanField(default=False, help_text='Recent application information posted (within 30 days)', verbose_name='Application Information')),
                ('has_decontamination_supplies', models.BooleanField(default=False, help_text='Emergency eye wash and water available', verbose_name='Decontamination Supplies')),
                ('last_verified_date', models.DateField(blank=True, null=True)),
                ('verification_notes', models.TextField(blank=True)),
                ('photo', models.ImageField(blank=True, help_text='Photo of posting location for documentation', null=True, upload_to='posting_locations/%Y/%m/')),
                ('active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='central_posting_locations', to='api.company')),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='central_posting_locations', to='api.farm')),
                ('last_verified_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_posting_locations', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Central Posting Location',
                'verbose_name_plural': 'Central Posting Locations',
                'ordering': ['farm__name', 'location_name'],
            },
        ),
        migrations.AddIndex(
            model_name='wpstrainingrecord',
            index=models.Index(fields=['company', 'training_type'], name='idx_wps_company_type'),
        ),
        migrations.AddIndex(
            model_name='wpstrainingrecord',
            index=models.Index(fields=['trainee_name', 'training_type'], name='idx_wps_trainee_type'),
        ),
        migrations.AddIndex(
            model_name='wpstrainingrecord',
            index=models.Index(fields=['expiration_date'], name='idx_wps_expiration'),
        ),
        migrations.AddIndex(
            model_name='reipostingrecord',
            index=models.Index(fields=['rei_end_datetime'], name='idx_rei_end_datetime'),
        ),
        migrations.AddIndex(
            model_name='notificationlog',
            index=models.Index(fields=['user', 'sent_at'], name='idx_notif_user_sent'),
        ),
        migrations.AddIndex(
            model_name='notificationlog',
            index=models.Index(fields=['notification_type', 'sent_at'], name='idx_notif_type_sent'),
        ),
        migrations.AddIndex(
            model_name='license',
            index=models.Index(fields=['company', 'status'], name='idx_license_company_status'),
        ),
        migrations.AddIndex(
            model_name='license',
            index=models.Index(fields=['user', 'license_type'], name='idx_license_user_type'),
        ),
        migrations.AddIndex(
            model_name='license',
            index=models.Index(fields=['expiration_date', 'status'], name='idx_license_exp_status'),
        ),
        migrations.AddIndex(
            model_name='incidentreport',
            index=models.Index(fields=['company', 'status'], name='idx_incident_company_status'),
        ),
        migrations.AddIndex(
            model_name='incidentreport',
            index=models.Index(fields=['incident_type', 'severity'], name='idx_incident_type_severity'),
        ),
        migrations.AddIndex(
            model_name='incidentreport',
            index=models.Index(fields=['incident_date'], name='idx_incident_date'),
        ),
        migrations.AddIndex(
            model_name='compliancereport',
            index=models.Index(fields=['company', 'report_type', 'status'], name='idx_report_company_type'),
        ),
        migrations.AddIndex(
            model_name='compliancereport',
            index=models.Index(fields=['reporting_period_end'], name='idx_report_period_end'),
        ),
        migrations.AddIndex(
            model_name='compliancedeadline',
            index=models.Index(fields=['company', 'status', 'due_date'], name='idx_deadline_company_status'),
        ),
        migrations.AddIndex(
            model_name='compliancedeadline',
            index=models.Index(fields=['company', 'category'], name='idx_deadline_company_cat'),
        ),
        migrations.AddIndex(
            model_name='compliancedeadline',
            index=models.Index(fields=['due_date', 'status'], name='idx_deadline_due_status'),
        ),
        migrations.AddIndex(
            model_name='compliancealert',
            index=models.Index(fields=['company', 'is_active', 'priority'], name='idx_alert_company_active'),
        ),
        migrations.AddIndex(
            model_name='compliancealert',
            index=models.Index(fields=['alert_type', 'is_active'], name='idx_alert_type_active'),
        ),
    ]
