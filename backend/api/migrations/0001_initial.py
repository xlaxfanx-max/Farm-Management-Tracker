# Generated by Django 6.0 on 2025-12-17 16:09

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='Buyer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200)),
                ('buyer_type', models.CharField(choices=[('packing_house', 'Packing House'), ('processor', 'Processor'), ('direct_sale', 'Direct Sale'), ('farmers_market', 'Farmers Market'), ('distributor', 'Distributor'), ('export', 'Export')], default='packing_house', max_length=20)),
                ('contact_name', models.CharField(blank=True, max_length=200)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('address', models.CharField(blank=True, max_length=255)),
                ('city', models.CharField(blank=True, max_length=100)),
                ('state', models.CharField(default='CA', max_length=2)),
                ('zip_code', models.CharField(blank=True, max_length=10)),
                ('license_number', models.CharField(blank=True, help_text='Packer/shipper license number if applicable', max_length=50)),
                ('payment_terms', models.CharField(blank=True, help_text='e.g., Net 30, COD, etc.', max_length=100)),
                ('active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name_plural': 'Buyers',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Company',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('uuid', models.UUIDField(default=uuid.uuid4, editable=False, unique=True)),
                ('name', models.CharField(max_length=200)),
                ('legal_name', models.CharField(blank=True, help_text='Legal business name if different from display name', max_length=200, null=True)),
                ('primary_contact_name', models.CharField(blank=True, max_length=100)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('address', models.CharField(blank=True, max_length=200)),
                ('city', models.CharField(blank=True, max_length=100)),
                ('state', models.CharField(default='CA', max_length=2)),
                ('zip_code', models.CharField(blank=True, max_length=10)),
                ('operator_id', models.CharField(blank=True, help_text='California DPR Operator ID Number', max_length=50)),
                ('business_license', models.CharField(blank=True, max_length=50)),
                ('subscription_tier', models.CharField(choices=[('free', 'Free Trial'), ('starter', 'Starter'), ('professional', 'Professional'), ('enterprise', 'Enterprise')], default='free', max_length=20)),
                ('subscription_start', models.DateField(blank=True, null=True)),
                ('subscription_end', models.DateField(blank=True, null=True)),
                ('max_farms', models.IntegerField(default=3, help_text='Maximum farms allowed for this subscription')),
                ('max_users', models.IntegerField(default=5, help_text='Maximum users allowed for this subscription')),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name_plural': 'Companies',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='LaborContractor',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('company_name', models.CharField(max_length=200)),
                ('contact_name', models.CharField(blank=True, max_length=200)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('address', models.CharField(blank=True, max_length=255)),
                ('city', models.CharField(blank=True, max_length=100)),
                ('state', models.CharField(default='CA', max_length=2)),
                ('zip_code', models.CharField(blank=True, max_length=10)),
                ('contractor_license', models.CharField(blank=True, help_text='Farm Labor Contractor License Number', max_length=50)),
                ('license_expiration', models.DateField(blank=True, null=True)),
                ('insurance_carrier', models.CharField(blank=True, max_length=200)),
                ('insurance_policy_number', models.CharField(blank=True, max_length=100)),
                ('insurance_expiration', models.DateField(blank=True, null=True)),
                ('workers_comp_carrier', models.CharField(blank=True, max_length=200)),
                ('workers_comp_policy', models.CharField(blank=True, max_length=100)),
                ('workers_comp_expiration', models.DateField(blank=True, null=True)),
                ('food_safety_training_current', models.BooleanField(default=False, help_text='Crew has current food safety training')),
                ('training_expiration', models.DateField(blank=True, null=True)),
                ('default_hourly_rate', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('default_piece_rate', models.DecimalField(blank=True, decimal_places=2, help_text='Rate per bin', max_digits=8, null=True)),
                ('active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Labor Contractor',
                'verbose_name_plural': 'Labor Contractors',
                'ordering': ['company_name'],
            },
        ),
        migrations.CreateModel(
            name='Permission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100)),
                ('codename', models.CharField(max_length=100, unique=True)),
                ('description', models.TextField(blank=True)),
                ('category', models.CharField(choices=[('farms', 'Farms & Fields'), ('applications', 'Pesticide Applications'), ('harvests', 'Harvests'), ('water', 'Water Quality'), ('reports', 'Reports'), ('users', 'User Management'), ('settings', 'Settings')], max_length=50)),
            ],
            options={
                'ordering': ['category', 'name'],
            },
        ),
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('email', models.EmailField(max_length=254, unique=True, verbose_name='email address')),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('job_title', models.CharField(blank=True, max_length=100)),
                ('applicator_license', models.CharField(blank=True, help_text='CA Qualified Applicator License number', max_length=50)),
                ('license_expiration', models.DateField(blank=True, null=True)),
                ('pca_license', models.CharField(blank=True, help_text='Pest Control Advisor license number', max_length=50)),
                ('timezone', models.CharField(default='America/Los_Angeles', max_length=50)),
                ('last_activity', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),
                ('current_company', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='current_users', to='api.company')),
            ],
            options={
                'ordering': ['email'],
            },
        ),
        migrations.CreateModel(
            name='Farm',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('gps_latitude', models.DecimalField(blank=True, decimal_places=7, help_text='GPS latitude coordinate (e.g., 34.428500)', max_digits=10, null=True, verbose_name='Latitude')),
                ('gps_longitude', models.DecimalField(blank=True, decimal_places=7, help_text='GPS longitude coordinate (e.g., -119.229000)', max_digits=10, null=True, verbose_name='Longitude')),
                ('plss_section', models.CharField(blank=True, help_text='Section number (1-36)', max_length=10, verbose_name='Section')),
                ('plss_township', models.CharField(blank=True, help_text="Township (e.g., '4N' for Township 4 North)", max_length=10, verbose_name='Township')),
                ('plss_range', models.CharField(blank=True, help_text="Range (e.g., '22W' for Range 22 West)", max_length=10, verbose_name='Range')),
                ('plss_meridian', models.CharField(blank=True, default='San Bernardino', help_text='Base meridian (San Bernardino for Southern CA)', max_length=50, verbose_name='Meridian')),
                ('name', models.CharField(max_length=200)),
                ('farm_number', models.CharField(blank=True, help_text='Internal farm ID or permit number', max_length=50)),
                ('owner_name', models.CharField(blank=True, max_length=200)),
                ('operator_name', models.CharField(blank=True, max_length=200)),
                ('address', models.TextField(blank=True)),
                ('county', models.CharField(max_length=100)),
                ('phone', models.CharField(blank=True, max_length=20)),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='farms', to='api.company')),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Field',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('gps_latitude', models.DecimalField(blank=True, decimal_places=7, help_text='GPS latitude coordinate (e.g., 34.428500)', max_digits=10, null=True, verbose_name='Latitude')),
                ('gps_longitude', models.DecimalField(blank=True, decimal_places=7, help_text='GPS longitude coordinate (e.g., -119.229000)', max_digits=10, null=True, verbose_name='Longitude')),
                ('plss_section', models.CharField(blank=True, help_text='Section number (1-36)', max_length=10, verbose_name='Section')),
                ('plss_township', models.CharField(blank=True, help_text="Township (e.g., '4N' for Township 4 North)", max_length=10, verbose_name='Township')),
                ('plss_range', models.CharField(blank=True, help_text="Range (e.g., '22W' for Range 22 West)", max_length=10, verbose_name='Range')),
                ('plss_meridian', models.CharField(blank=True, default='San Bernardino', help_text='Base meridian (San Bernardino for Southern CA)', max_length=50, verbose_name='Meridian')),
                ('name', models.CharField(max_length=200)),
                ('field_number', models.CharField(max_length=50)),
                ('county', models.CharField(max_length=100)),
                ('boundary_geojson', models.JSONField(blank=True, help_text='Field boundary polygon in GeoJSON format', null=True, verbose_name='Boundary GeoJSON')),
                ('calculated_acres', models.DecimalField(blank=True, decimal_places=2, help_text='Acreage calculated from drawn boundary', max_digits=10, null=True, verbose_name='Calculated Acres')),
                ('total_acres', models.DecimalField(decimal_places=2, max_digits=10)),
                ('current_crop', models.CharField(max_length=100)),
                ('planting_date', models.DateField(blank=True, null=True)),
                ('active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('farm', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='fields', to='api.farm')),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Harvest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('harvest_date', models.DateField()),
                ('harvest_number', models.PositiveIntegerField(default=1, help_text='Pick number this season (1st, 2nd, 3rd pick)')),
                ('crop_variety', models.CharField(choices=[('navel_orange', 'Navel Orange'), ('valencia_orange', 'Valencia Orange'), ('cara_cara', 'Cara Cara Orange'), ('blood_orange', 'Blood Orange'), ('meyer_lemon', 'Meyer Lemon'), ('eureka_lemon', 'Eureka Lemon'), ('lisbon_lemon', 'Lisbon Lemon'), ('lime', 'Lime'), ('grapefruit_white', 'White Grapefruit'), ('grapefruit_ruby', 'Ruby Red Grapefruit'), ('mandarin', 'Mandarin'), ('tangerine', 'Tangerine'), ('clementine', 'Clementine'), ('satsuma', 'Satsuma'), ('tangelo', 'Tangelo'), ('kumquat', 'Kumquat'), ('other', 'Other')], default='navel_orange', max_length=30)),
                ('acres_harvested', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))])),
                ('total_bins', models.PositiveIntegerField(default=0)),
                ('bin_weight_lbs', models.PositiveIntegerField(default=900, help_text='Weight per bin in pounds')),
                ('estimated_weight_lbs', models.DecimalField(blank=True, decimal_places=2, help_text='Auto-calculated from bins × bin_weight', max_digits=12, null=True)),
                ('phi_verified', models.BooleanField(default=False, help_text='User confirms PHI compliance check performed')),
                ('last_application_date', models.DateField(blank=True, help_text='Auto-populated from most recent application', null=True)),
                ('last_application_product', models.CharField(blank=True, help_text='Auto-populated', max_length=200)),
                ('days_since_last_application', models.PositiveIntegerField(blank=True, help_text='Auto-calculated', null=True)),
                ('phi_required_days', models.PositiveIntegerField(blank=True, help_text='PHI from product label', null=True)),
                ('phi_compliant', models.BooleanField(blank=True, help_text='Auto-calculated: days_since >= phi_required', null=True)),
                ('lot_number', models.CharField(blank=True, help_text='Auto-generated if blank', max_length=50, unique=True)),
                ('field_conditions', models.TextField(blank=True, help_text='Weather, ground conditions, etc.')),
                ('equipment_cleaned', models.BooleanField(default=False, help_text='Harvest equipment sanitation verified')),
                ('no_contamination_observed', models.BooleanField(default=False, help_text='No glass, metal, animal intrusion observed')),
                ('supervisor_name', models.CharField(blank=True, max_length=200)),
                ('status', models.CharField(choices=[('in_progress', 'In Progress'), ('complete', 'Complete'), ('verified', 'Verified')], default='in_progress', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('field', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='harvests', to='api.field')),
            ],
            options={
                'verbose_name_plural': 'Harvests',
                'ordering': ['-harvest_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='HarvestLoad',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('load_number', models.PositiveIntegerField(default=1, help_text='Load number within this harvest')),
                ('bins', models.PositiveIntegerField(default=0)),
                ('weight_lbs', models.DecimalField(blank=True, decimal_places=2, help_text='Scale weight', max_digits=12, null=True)),
                ('weight_ticket_number', models.CharField(blank=True, help_text='Scale ticket reference', max_length=50)),
                ('destination_address', models.CharField(blank=True, help_text='Override buyer address if different', max_length=255)),
                ('grade', models.CharField(choices=[('fancy', 'Fancy'), ('choice', 'Choice'), ('standard', 'Standard'), ('juice', 'Juice Grade'), ('reject', 'Reject/Cull')], default='choice', max_length=20)),
                ('size_grade', models.CharField(blank=True, choices=[('48', '48'), ('56', '56'), ('72', '72'), ('88', '88'), ('113', '113'), ('138', '138'), ('163', '163'), ('180', '180'), ('200', '200'), ('235', '235'), ('mixed', 'Mixed')], max_length=10)),
                ('quality_notes', models.TextField(blank=True, help_text='Brix, color, defects, etc.')),
                ('price_per_unit', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('price_unit', models.CharField(choices=[('per_bin', 'Per Bin'), ('per_lb', 'Per Pound'), ('per_ton', 'Per Ton'), ('per_box', 'Per Box'), ('per_carton', 'Per Carton'), ('flat_rate', 'Flat Rate')], default='per_bin', max_length=20)),
                ('total_revenue', models.DecimalField(blank=True, decimal_places=2, help_text='Auto-calculated or manual override', max_digits=12, null=True)),
                ('payment_status', models.CharField(choices=[('pending', 'Pending'), ('invoiced', 'Invoiced'), ('partial', 'Partially Paid'), ('paid', 'Paid'), ('disputed', 'Disputed')], default='pending', max_length=20)),
                ('payment_date', models.DateField(blank=True, null=True)),
                ('invoice_number', models.CharField(blank=True, max_length=50)),
                ('truck_id', models.CharField(blank=True, help_text='License plate or truck number', max_length=50)),
                ('trailer_id', models.CharField(blank=True, max_length=50)),
                ('driver_name', models.CharField(blank=True, max_length=200)),
                ('departure_time', models.DateTimeField(blank=True, null=True)),
                ('arrival_time', models.DateTimeField(blank=True, null=True)),
                ('temperature_at_loading', models.DecimalField(blank=True, decimal_places=1, help_text='°F at time of loading', max_digits=5, null=True)),
                ('seal_number', models.CharField(blank=True, help_text='Trailer seal number if applicable', max_length=50)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('buyer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='loads', to='api.buyer')),
                ('harvest', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='loads', to='api.harvest')),
            ],
            options={
                'verbose_name': 'Harvest Load',
                'verbose_name_plural': 'Harvest Loads',
                'ordering': ['harvest', 'load_number'],
            },
        ),
        migrations.CreateModel(
            name='HarvestLabor',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('crew_name', models.CharField(blank=True, help_text='Crew identifier or name', max_length=200)),
                ('foreman_name', models.CharField(blank=True, max_length=200)),
                ('worker_count', models.PositiveIntegerField(default=1)),
                ('start_time', models.DateTimeField(blank=True, null=True)),
                ('end_time', models.DateTimeField(blank=True, null=True)),
                ('total_hours', models.DecimalField(blank=True, decimal_places=2, help_text='Auto-calculated or manual entry', max_digits=8, null=True)),
                ('pay_type', models.CharField(choices=[('hourly', 'Hourly'), ('piece_rate', 'Piece Rate (per bin)'), ('contract', 'Contract/Flat Rate')], default='piece_rate', max_length=20)),
                ('rate', models.DecimalField(blank=True, decimal_places=2, help_text='$/hour or $/bin depending on pay_type', max_digits=10, null=True)),
                ('bins_picked', models.PositiveIntegerField(blank=True, help_text='For piece rate calculation', null=True)),
                ('total_labor_cost', models.DecimalField(blank=True, decimal_places=2, help_text='Auto-calculated or manual entry', max_digits=12, null=True)),
                ('training_verified', models.BooleanField(default=False, help_text='Workers have current food safety training')),
                ('hygiene_facilities_available', models.BooleanField(default=False, help_text='Handwashing stations and toilets available')),
                ('illness_check_performed', models.BooleanField(default=False, help_text='Workers checked for illness/symptoms')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('harvest', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='labor_records', to='api.harvest')),
                ('contractor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='harvest_jobs', to='api.laborcontractor')),
            ],
            options={
                'verbose_name': 'Harvest Labor Record',
                'verbose_name_plural': 'Harvest Labor Records',
                'ordering': ['harvest', '-start_time'],
            },
        ),
        migrations.CreateModel(
            name='PesticideProduct',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('epa_registration_number', models.CharField(help_text='EPA Registration Number (e.g., 12345-678)', max_length=50, unique=True)),
                ('product_name', models.CharField(help_text='Product trade name', max_length=200)),
                ('manufacturer', models.CharField(blank=True, help_text='Manufacturer/registrant name', max_length=200)),
                ('active_ingredients', models.TextField(blank=True, help_text='Active ingredient(s) and percentages')),
                ('formulation_type', models.CharField(blank=True, help_text='e.g., EC, WP, G, etc.', max_length=50)),
                ('restricted_use', models.BooleanField(default=False, help_text='Restricted Use Pesticide (RUP)')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('product_type', models.CharField(blank=True, choices=[('insecticide', 'Insecticide'), ('herbicide', 'Herbicide'), ('fungicide', 'Fungicide'), ('fumigant', 'Fumigant'), ('adjuvant', 'Adjuvant'), ('plant_growth_regulator', 'Plant Growth Regulator'), ('rodenticide', 'Rodenticide'), ('other', 'Other')], help_text='Primary product type', max_length=50)),
                ('is_fumigant', models.BooleanField(default=False, help_text='Is this a fumigant product?')),
                ('signal_word', models.CharField(blank=True, choices=[('DANGER', 'Danger'), ('WARNING', 'Warning'), ('CAUTION', 'Caution'), ('NONE', 'None')], help_text='Signal word from label', max_length=20)),
                ('rei_hours', models.DecimalField(blank=True, decimal_places=2, help_text='Re-Entry Interval in hours (e.g., 12, 24, 48)', max_digits=6, null=True)),
                ('rei_days', models.IntegerField(blank=True, help_text='Alternative REI in days (some products use days)', null=True)),
                ('phi_days', models.IntegerField(blank=True, help_text='Pre-Harvest Interval in days', null=True)),
                ('max_applications_per_season', models.IntegerField(blank=True, help_text='Maximum number of applications per season', null=True)),
                ('max_rate_per_application', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum rate per application', max_digits=10, null=True)),
                ('max_rate_unit', models.CharField(blank=True, choices=[('lbs/acre', 'lbs/acre'), ('gal/acre', 'gal/acre'), ('oz/acre', 'oz/acre'), ('fl oz/acre', 'fl oz/acre'), ('kg/ha', 'kg/ha'), ('L/ha', 'L/ha')], help_text='Unit for max rate', max_length=20)),
                ('california_registration_number', models.CharField(blank=True, help_text='California DPR registration number (if different from EPA)', max_length=50)),
                ('active_status_california', models.BooleanField(default=True, help_text='Currently registered for use in California?')),
                ('formulation_code', models.CharField(blank=True, help_text='EPA formulation code (e.g., EC, WP, G)', max_length=10)),
                ('density_specific_gravity', models.DecimalField(blank=True, decimal_places=4, help_text='Specific gravity or density (for conversions)', max_digits=6, null=True)),
                ('approved_crops', models.TextField(blank=True, help_text='Comma-separated list of approved crops/sites')),
                ('groundwater_advisory', models.BooleanField(default=False, help_text='Has groundwater advisory?')),
                ('endangered_species_restrictions', models.BooleanField(default=False, help_text='Has endangered species restrictions?')),
                ('buffer_zone_required', models.BooleanField(default=False, help_text='Requires buffer zones?')),
                ('buffer_zone_feet', models.IntegerField(blank=True, help_text='Buffer zone distance in feet', null=True)),
                ('product_status', models.CharField(choices=[('active', 'Active'), ('discontinued', 'Discontinued'), ('suspended', 'Suspended'), ('cancelled', 'Cancelled')], default='active', help_text='Current product status', max_length=20)),
                ('unit_size', models.CharField(blank=True, help_text="Standard unit size (e.g., '2.5 gallon jug', '50 lb bag')", max_length=50)),
                ('cost_per_unit', models.DecimalField(blank=True, decimal_places=2, help_text='Cost per unit (for cost tracking)', max_digits=10, null=True)),
                ('label_url', models.URLField(blank=True, help_text='URL to product label PDF')),
                ('sds_url', models.URLField(blank=True, help_text='URL to Safety Data Sheet')),
                ('notes', models.TextField(blank=True, help_text='Additional notes or special instructions')),
                ('active', models.BooleanField(default=True, help_text='Is this product actively used on your farm?')),
                ('search_keywords', models.TextField(blank=True, help_text='Additional keywords for searching (auto-populated)')),
            ],
            options={
                'verbose_name': 'Pesticide Product',
                'verbose_name_plural': 'Pesticide Products',
                'ordering': ['product_name'],
                'indexes': [models.Index(fields=['epa_registration_number'], name='api_pestici_epa_reg_a75ecb_idx'), models.Index(fields=['product_name'], name='api_pestici_product_d79a9e_idx'), models.Index(fields=['product_type'], name='api_pestici_product_d46387_idx'), models.Index(fields=['active'], name='api_pestici_active_46e045_idx')],
            },
        ),
        migrations.CreateModel(
            name='PesticideApplication',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('application_date', models.DateField()),
                ('start_time', models.TimeField()),
                ('end_time', models.TimeField()),
                ('acres_treated', models.DecimalField(decimal_places=2, max_digits=10)),
                ('amount_used', models.DecimalField(decimal_places=2, max_digits=10)),
                ('unit_of_measure', models.CharField(choices=[('gal', 'Gallons'), ('lbs', 'Pounds'), ('oz', 'Ounces'), ('pt', 'Pints'), ('qt', 'Quarts')], max_length=20)),
                ('application_method', models.CharField(choices=[('Ground Spray', 'Ground Spray'), ('Aerial Application', 'Aerial Application'), ('Chemigation', 'Chemigation'), ('Soil Injection', 'Soil Injection'), ('Broadcast', 'Broadcast Application')], max_length=100)),
                ('target_pest', models.CharField(blank=True, max_length=200)),
                ('applicator_name', models.CharField(max_length=200)),
                ('applicator_license_no', models.CharField(blank=True, help_text='California Department of Pesticide Regulation license number', max_length=50)),
                ('temperature', models.DecimalField(blank=True, decimal_places=1, max_digits=5, null=True)),
                ('wind_speed', models.DecimalField(blank=True, decimal_places=1, max_digits=5, null=True)),
                ('wind_direction', models.CharField(blank=True, choices=[('N', 'North'), ('NE', 'Northeast'), ('E', 'East'), ('SE', 'Southeast'), ('S', 'South'), ('SW', 'Southwest'), ('W', 'West'), ('NW', 'Northwest')], max_length=2)),
                ('notes', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('pending_signature', 'Pending Signature'), ('complete', 'Complete'), ('submitted', 'Submitted to PUR')], default='pending_signature', max_length=20)),
                ('submitted_to_pur', models.BooleanField(default=False)),
                ('pur_submission_date', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('field', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='applications', to='api.field')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='applications', to='api.pesticideproduct')),
            ],
            options={
                'ordering': ['-application_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Role',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50)),
                ('codename', models.CharField(max_length=50, unique=True)),
                ('description', models.TextField(blank=True)),
                ('is_system_role', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('permissions', models.ManyToManyField(blank=True, related_name='roles', to='api.permission')),
            ],
            options={
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Invitation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('email', models.EmailField(max_length=254)),
                ('token', models.UUIDField(default=uuid.uuid4, unique=True)),
                ('message', models.TextField(blank=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('accepted', 'Accepted'), ('expired', 'Expired'), ('revoked', 'Revoked')], default='pending', max_length=20)),
                ('expires_at', models.DateTimeField()),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('accepted_at', models.DateTimeField(blank=True, null=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='invitations', to='api.company')),
                ('invited_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='invitations_sent', to=settings.AUTH_USER_MODEL)),
                ('role', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='invitations', to='api.role')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='WaterSource',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('gps_latitude', models.DecimalField(blank=True, decimal_places=7, help_text='GPS latitude coordinate (e.g., 34.428500)', max_digits=10, null=True, verbose_name='Latitude')),
                ('gps_longitude', models.DecimalField(blank=True, decimal_places=7, help_text='GPS longitude coordinate (e.g., -119.229000)', max_digits=10, null=True, verbose_name='Longitude')),
                ('plss_section', models.CharField(blank=True, help_text='Section number (1-36)', max_length=10, verbose_name='Section')),
                ('plss_township', models.CharField(blank=True, help_text="Township (e.g., '4N' for Township 4 North)", max_length=10, verbose_name='Township')),
                ('plss_range', models.CharField(blank=True, help_text="Range (e.g., '22W' for Range 22 West)", max_length=10, verbose_name='Range')),
                ('plss_meridian', models.CharField(blank=True, default='San Bernardino', help_text='Base meridian (San Bernardino for Southern CA)', max_length=50, verbose_name='Meridian')),
                ('name', models.CharField(help_text="e.g., 'Well #1', 'North Pond'", max_length=200)),
                ('source_type', models.CharField(choices=[('well', 'Groundwater Well'), ('municipal', 'Municipal/Public'), ('surface', 'Surface Water (pond, stream, etc.)'), ('recycled', 'Recycled Water'), ('other', 'Other')], default='well', max_length=20)),
                ('location_description', models.TextField(blank=True, help_text='Physical location description')),
                ('inherit_location_from_farm', models.BooleanField(default=True, help_text="If true, use farm's GPS/PLSS; if false, use this record's location")),
                ('used_for_irrigation', models.BooleanField(default=True)),
                ('used_for_washing', models.BooleanField(default=False)),
                ('used_for_pesticide_mixing', models.BooleanField(default=False)),
                ('test_frequency_days', models.IntegerField(default=365, help_text='How often to test (365 = annually, 90 = quarterly)')),
                ('active', models.BooleanField(default=True)),
                ('well_name', models.CharField(blank=True, help_text='Common name for the well', max_length=100)),
                ('state_well_number', models.CharField(blank=True, help_text='California DWR State Well Number', max_length=50)),
                ('local_well_id', models.CharField(blank=True, help_text='County well permit number', max_length=50)),
                ('gsa_well_id', models.CharField(blank=True, help_text='GSA-assigned well identifier', max_length=50)),
                ('gsa', models.CharField(blank=True, choices=[('obgma', 'Ojai Basin Groundwater Management Agency (OBGMA)'), ('fpbgsa', 'Fillmore and Piru Basins GSA'), ('uvrga', 'Upper Ventura River Groundwater Agency'), ('fcgma', 'Fox Canyon Groundwater Management Agency'), ('other', 'Other'), ('none', 'Not in GSA Jurisdiction')], help_text='Groundwater Sustainability Agency', max_length=20)),
                ('gsa_account_number', models.CharField(blank=True, help_text='Account number with the GSA', max_length=50)),
                ('basin', models.CharField(blank=True, choices=[('ojai_valley', 'Ojai Valley (4-002)'), ('upper_ventura_river', 'Upper Ventura River (4-003.01)'), ('lower_ventura_river', 'Lower Ventura River (4-003.02)'), ('fillmore', 'Santa Clara River Valley - Fillmore (4-004.05)'), ('piru', 'Santa Clara River Valley - Piru (4-004.06)'), ('santa_paula', 'Santa Clara River Valley - Santa Paula (4-004.04)'), ('oxnard', 'Santa Clara River Valley - Oxnard (4-004.02)'), ('pleasant_valley', 'Pleasant Valley (4-006)'), ('las_posas', 'Las Posas Valley (4-008)'), ('arroyo_santa_rosa', 'Arroyo Santa Rosa Valley (4-007)'), ('mound', 'Mound (4-004.01)'), ('other', 'Other')], help_text='DWR Bulletin 118 basin', max_length=30)),
                ('basin_priority', models.CharField(blank=True, choices=[('critical', 'Critically Overdrafted'), ('high', 'High Priority'), ('medium', 'Medium Priority'), ('low', 'Low Priority'), ('very_low', 'Very Low Priority')], max_length=20)),
                ('well_depth_ft', models.DecimalField(blank=True, decimal_places=2, help_text='Total well depth in feet', max_digits=7, null=True)),
                ('casing_diameter_inches', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('screen_interval_top_ft', models.DecimalField(blank=True, decimal_places=2, max_digits=7, null=True)),
                ('screen_interval_bottom_ft', models.DecimalField(blank=True, decimal_places=2, max_digits=7, null=True)),
                ('static_water_level_ft', models.DecimalField(blank=True, decimal_places=2, max_digits=7, null=True)),
                ('static_level_date', models.DateField(blank=True, null=True)),
                ('aquifer_name', models.CharField(blank=True, max_length=100)),
                ('parcel_apn', models.CharField(blank=True, help_text="Assessor's Parcel Number", max_length=20)),
                ('quarter_quarter', models.CharField(blank=True, help_text='Quarter-quarter section (e.g., NE/SW)', max_length=10)),
                ('pump_type', models.CharField(blank=True, choices=[('submersible', 'Submersible'), ('turbine', 'Vertical Turbine'), ('jet', 'Jet Pump'), ('centrifugal', 'Centrifugal'), ('other', 'Other')], max_length=20)),
                ('pump_horsepower', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('pump_flow_rate_gpm', models.DecimalField(blank=True, decimal_places=2, help_text='GPM', max_digits=8, null=True)),
                ('pump_efficiency', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('pump_installation_date', models.DateField(blank=True, null=True)),
                ('pump_manufacturer', models.CharField(blank=True, max_length=100)),
                ('pump_model', models.CharField(blank=True, max_length=100)),
                ('power_source', models.CharField(blank=True, choices=[('electric_utility', 'Electric - Utility'), ('electric_solar', 'Electric - Solar'), ('diesel', 'Diesel Engine'), ('natural_gas', 'Natural Gas Engine'), ('propane', 'Propane Engine'), ('other', 'Other')], max_length=20)),
                ('utility_meter_number', models.CharField(blank=True, max_length=50)),
                ('has_flowmeter', models.BooleanField(default=False)),
                ('flowmeter_make', models.CharField(blank=True, max_length=100)),
                ('flowmeter_model', models.CharField(blank=True, max_length=100)),
                ('flowmeter_serial_number', models.CharField(blank=True, max_length=100)),
                ('flowmeter_size_inches', models.DecimalField(blank=True, decimal_places=2, max_digits=4, null=True)),
                ('flowmeter_installation_date', models.DateField(blank=True, null=True)),
                ('flowmeter_units', models.CharField(choices=[('acre_feet', 'Acre-Feet'), ('gallons', 'Gallons'), ('hundred_gallons', 'Hundred Gallons'), ('thousand_gallons', 'Thousand Gallons'), ('cubic_feet', 'Cubic Feet'), ('hundred_cubic_feet', 'Hundred Cubic Feet (CCF)')], default='acre_feet', max_length=20)),
                ('flowmeter_multiplier', models.DecimalField(decimal_places=4, default=1.0, max_digits=10)),
                ('flowmeter_decimal_places', models.IntegerField(default=2)),
                ('has_ami', models.BooleanField(default=False)),
                ('ami_vendor', models.CharField(blank=True, max_length=100)),
                ('ami_device_id', models.CharField(blank=True, max_length=100)),
                ('ami_installation_date', models.DateField(blank=True, null=True)),
                ('well_construction_date', models.DateField(blank=True, null=True)),
                ('well_permit_date', models.DateField(blank=True, null=True)),
                ('well_permit_number', models.CharField(blank=True, max_length=50)),
                ('driller_name', models.CharField(blank=True, max_length=100)),
                ('driller_license', models.CharField(blank=True, max_length=50)),
                ('well_log_available', models.BooleanField(default=False)),
                ('well_log_file', models.FileField(blank=True, null=True, upload_to='well_logs/')),
                ('well_status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive'), ('standby', 'Standby/Emergency'), ('destroyed', 'Destroyed/Abandoned'), ('monitoring', 'Monitoring Only')], default='active', max_length=20)),
                ('is_de_minimis', models.BooleanField(default=False, help_text='Domestic well < 2 AF/year')),
                ('registered_with_gsa', models.BooleanField(default=False)),
                ('gsa_registration_date', models.DateField(blank=True, null=True)),
                ('meter_calibration_current', models.BooleanField(default=False)),
                ('next_calibration_due', models.DateField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='water_sources', to='api.farm')),
                ('fields_served', models.ManyToManyField(blank=True, related_name='water_sources', to='api.field')),
            ],
            options={
                'verbose_name': 'Water Source',
                'verbose_name_plural': 'Water Sources',
                'ordering': ['farm', 'name'],
            },
        ),
        migrations.CreateModel(
            name='WaterAllocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('water_year', models.CharField(help_text="Water year (e.g., '2024-2025' for Oct 2024 - Sep 2025)", max_length=9)),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('allocation_type', models.CharField(choices=[('base', 'Base Allocation'), ('historical', 'Historical Use Allocation'), ('supplemental', 'Supplemental Allocation'), ('carryover', 'Carryover from Previous Year'), ('purchased', 'Purchased (Water Market)'), ('transferred_in', 'Transferred In'), ('transferred_out', 'Transferred Out')], default='base', max_length=20)),
                ('allocated_acre_feet', models.DecimalField(decimal_places=4, help_text='Allocated extraction amount in acre-feet', max_digits=10)),
                ('source', models.CharField(choices=[('gsa', 'GSA Base Allocation'), ('water_market', 'Water Market Purchase'), ('transfer', 'Direct Transfer'), ('recharge_credit', 'Recharge Credit')], default='gsa', max_length=20)),
                ('source_well_id', models.CharField(blank=True, help_text='Source well ID if transferred/purchased', max_length=50)),
                ('transfer_agreement_number', models.CharField(blank=True, help_text='GSA transfer/water market agreement number', max_length=50)),
                ('cost_per_acre_foot', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('total_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('allocation_notice', models.FileField(blank=True, null=True, upload_to='allocation_notices/')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('water_source', models.ForeignKey(limit_choices_to={'source_type': 'well'}, on_delete=django.db.models.deletion.CASCADE, related_name='allocations', to='api.watersource')),
            ],
            options={
                'verbose_name': 'Water Allocation',
                'verbose_name_plural': 'Water Allocations',
                'ordering': ['-water_year', 'water_source'],
            },
        ),
        migrations.CreateModel(
            name='MeterCalibration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('calibration_date', models.DateField()),
                ('next_calibration_due', models.DateField(help_text='Typically 3 years from calibration date')),
                ('calibration_type', models.CharField(choices=[('field', 'Field Calibration'), ('shop', 'Shop/Bench Calibration'), ('replacement', 'Meter Replacement'), ('initial', 'Initial Installation')], default='field', max_length=20)),
                ('pre_calibration_accuracy', models.DecimalField(blank=True, decimal_places=2, help_text='Accuracy percentage before calibration', max_digits=6, null=True)),
                ('post_calibration_accuracy', models.DecimalField(blank=True, decimal_places=2, help_text='Accuracy percentage after calibration (must be within +/- 5%)', max_digits=6, null=True)),
                ('passed', models.BooleanField(default=False, help_text='Did calibration meet required accuracy standards?')),
                ('meter_reading_before', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True)),
                ('meter_reading_after', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True)),
                ('meter_replaced', models.BooleanField(default=False)),
                ('new_meter_serial', models.CharField(blank=True, help_text='If meter was replaced, new serial number', max_length=100)),
                ('new_meter_make', models.CharField(blank=True, max_length=100)),
                ('new_meter_model', models.CharField(blank=True, max_length=100)),
                ('calibration_company', models.CharField(blank=True, max_length=200)),
                ('technician_name', models.CharField(blank=True, max_length=100)),
                ('technician_license', models.CharField(blank=True, max_length=50)),
                ('technician_phone', models.CharField(blank=True, max_length=20)),
                ('calibration_report', models.FileField(blank=True, help_text='Upload calibration test report PDF', null=True, upload_to='calibration_reports/')),
                ('invoice', models.FileField(blank=True, null=True, upload_to='calibration_invoices/')),
                ('cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('water_source', models.ForeignKey(limit_choices_to={'source_type': 'well'}, on_delete=django.db.models.deletion.CASCADE, related_name='calibrations', to='api.watersource')),
            ],
            options={
                'verbose_name': 'Meter Calibration',
                'verbose_name_plural': 'Meter Calibrations',
                'ordering': ['-calibration_date'],
            },
        ),
        migrations.CreateModel(
            name='IrrigationEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('irrigation_date', models.DateField()),
                ('start_time', models.TimeField(blank=True, null=True)),
                ('end_time', models.TimeField(blank=True, null=True)),
                ('duration_hours', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('measurement_method', models.CharField(choices=[('meter', 'Flowmeter Reading'), ('calculated', 'Calculated (flow rate × time)'), ('estimated', 'Estimated')], default='calculated', max_length=20)),
                ('water_applied_af', models.DecimalField(blank=True, decimal_places=6, help_text='Water applied in acre-feet', max_digits=10, null=True)),
                ('water_applied_gallons', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('acre_inches', models.DecimalField(blank=True, decimal_places=4, help_text='Inches of water applied across field', max_digits=8, null=True)),
                ('irrigation_method', models.CharField(blank=True, choices=[('drip', 'Drip'), ('micro_sprinkler', 'Micro-Sprinkler'), ('sprinkler', 'Sprinkler'), ('flood', 'Flood/Furrow'), ('pivot', 'Center Pivot'), ('hand_water', 'Hand Watering'), ('other', 'Other')], max_length=20)),
                ('zone_or_block', models.CharField(blank=True, help_text='Specific zone or block irrigated', max_length=50)),
                ('acres_irrigated', models.DecimalField(blank=True, decimal_places=2, help_text='Acres irrigated (may be less than total field acres)', max_digits=8, null=True)),
                ('recorded_by', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('field', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='irrigation_events', to='api.field')),
                ('water_source', models.ForeignKey(blank=True, help_text='Water source used (well, municipal, surface, etc.)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='irrigation_events', to='api.watersource')),
            ],
            options={
                'verbose_name': 'Irrigation Event',
                'verbose_name_plural': 'Irrigation Events',
                'ordering': ['-irrigation_date', '-start_time'],
            },
        ),
        migrations.CreateModel(
            name='WaterTest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('test_date', models.DateField()),
                ('test_type', models.CharField(choices=[('microbial', 'Microbial (E. coli/Coliform)'), ('chemical', 'Chemical Analysis'), ('both', 'Microbial & Chemical')], max_length=20)),
                ('lab_name', models.CharField(blank=True, help_text='Testing laboratory', max_length=200)),
                ('lab_certification_number', models.CharField(blank=True, max_length=100)),
                ('ecoli_result', models.DecimalField(blank=True, decimal_places=2, help_text='E. coli count (CFU or MPN per 100mL)', max_digits=10, null=True)),
                ('total_coliform_result', models.DecimalField(blank=True, decimal_places=2, help_text='Total coliform count', max_digits=10, null=True)),
                ('ph_level', models.DecimalField(blank=True, decimal_places=2, max_digits=4, null=True)),
                ('nitrate_level', models.DecimalField(blank=True, decimal_places=2, help_text='mg/L', max_digits=10, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending Results'), ('pass', 'Pass'), ('fail', 'Fail - Action Required')], default='pending', max_length=20)),
                ('corrective_actions', models.TextField(blank=True, help_text='Actions taken if test failed (e.g., stopped use, re-treatment, re-test)')),
                ('retest_date', models.DateField(blank=True, null=True)),
                ('lab_report_file', models.FileField(blank=True, null=True, upload_to='water_tests/')),
                ('notes', models.TextField(blank=True)),
                ('recorded_by', models.CharField(blank=True, max_length=200)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('water_source', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='water_tests', to='api.watersource')),
            ],
            options={
                'ordering': ['-test_date'],
            },
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action', models.CharField(choices=[('create', 'Created'), ('update', 'Updated'), ('delete', 'Deleted'), ('login', 'Logged In'), ('logout', 'Logged Out'), ('export', 'Exported Data'), ('submit', 'Submitted Report'), ('invite', 'Sent Invitation')], max_length=20)),
                ('model_name', models.CharField(max_length=100)),
                ('object_id', models.CharField(blank=True, max_length=50)),
                ('object_repr', models.CharField(blank=True, max_length=200)),
                ('changes', models.JSONField(blank=True, default=dict)),
                ('ip_address', models.GenericIPAddressField(blank=True, null=True)),
                ('user_agent', models.CharField(blank=True, max_length=500)),
                ('timestamp', models.DateTimeField(auto_now_add=True)),
                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_logs', to=settings.AUTH_USER_MODEL)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='audit_logs', to='api.company')),
            ],
            options={
                'ordering': ['-timestamp'],
                'indexes': [models.Index(fields=['company', 'timestamp'], name='api_auditlo_company_d2e5fc_idx'), models.Index(fields=['user', 'timestamp'], name='api_auditlo_user_id_8f69e8_idx'), models.Index(fields=['model_name', 'object_id'], name='api_auditlo_model_n_a07f72_idx')],
            },
        ),
        migrations.CreateModel(
            name='FarmParcel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('apn', models.CharField(help_text='County assessor parcel number (e.g., 123-0-456-789)', max_length=50, verbose_name='Assessor Parcel Number')),
                ('acreage', models.DecimalField(blank=True, decimal_places=2, help_text='Acreage of this parcel', max_digits=10, null=True)),
                ('ownership_type', models.CharField(choices=[('owned', 'Owned'), ('leased', 'Leased'), ('managed', 'Managed')], default='owned', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='parcels', to='api.farm')),
            ],
            options={
                'verbose_name': 'Farm Parcel',
                'verbose_name_plural': 'Farm Parcels',
                'ordering': ['apn'],
                'unique_together': {('farm', 'apn')},
            },
        ),
        migrations.CreateModel(
            name='CompanyMembership',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('invited_at', models.DateTimeField(blank=True, null=True)),
                ('accepted_at', models.DateTimeField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='memberships', to='api.company')),
                ('invited_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sent_invitations', to=settings.AUTH_USER_MODEL)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='company_memberships', to=settings.AUTH_USER_MODEL)),
                ('allowed_farms', models.ManyToManyField(blank=True, help_text='If set, restricts user to only these farms', related_name='allowed_members', to='api.farm')),
                ('role', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='memberships', to='api.role')),
            ],
            options={
                'ordering': ['company', 'user'],
                'unique_together': {('user', 'company')},
            },
        ),
        migrations.CreateModel(
            name='ExtractionReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('period_type', models.CharField(choices=[('semi_annual_1', 'Semi-Annual Period 1 (Oct-Mar)'), ('semi_annual_2', 'Semi-Annual Period 2 (Apr-Sep)'), ('annual', 'Annual (Full Water Year)'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly')], default='semi_annual_1', max_length=20)),
                ('reporting_period', models.CharField(help_text="Period identifier (e.g., '2024-1' for Oct 2023 - Mar 2024)", max_length=20)),
                ('period_start_date', models.DateField()),
                ('period_end_date', models.DateField()),
                ('beginning_meter_reading', models.DecimalField(decimal_places=4, help_text='Meter reading at start of period', max_digits=15)),
                ('beginning_reading_date', models.DateField(blank=True, null=True)),
                ('ending_meter_reading', models.DecimalField(decimal_places=4, help_text='Meter reading at end of period', max_digits=15)),
                ('ending_reading_date', models.DateField(blank=True, null=True)),
                ('total_extraction_native', models.DecimalField(blank=True, decimal_places=4, help_text="Total extraction in meter's native units", max_digits=15, null=True)),
                ('total_extraction_af', models.DecimalField(blank=True, decimal_places=6, help_text='Total extraction in acre-feet', max_digits=12, null=True)),
                ('total_extraction_gallons', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('period_allocation_af', models.DecimalField(blank=True, decimal_places=4, help_text='Allocation for this period', max_digits=10, null=True)),
                ('allocation_remaining_af', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True)),
                ('over_allocation', models.BooleanField(default=False, help_text='Did extraction exceed allocation?')),
                ('over_allocation_af', models.DecimalField(blank=True, decimal_places=4, help_text='Amount over allocation', max_digits=10, null=True)),
                ('extraction_fee_rate', models.DecimalField(blank=True, decimal_places=4, help_text='Fee rate per acre-foot', max_digits=8, null=True)),
                ('base_extraction_fee', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('surcharge_rate', models.DecimalField(blank=True, decimal_places=4, help_text='Surcharge rate for over-allocation', max_digits=8, null=True)),
                ('surcharge_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('administrative_fee', models.DecimalField(blank=True, decimal_places=2, help_text='Any additional administrative fees', max_digits=10, null=True)),
                ('total_fees_due', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('ready', 'Ready to Submit'), ('submitted', 'Submitted to GSA'), ('confirmed', 'Confirmed by GSA'), ('revision_needed', 'Revision Needed')], default='draft', max_length=20)),
                ('submitted_date', models.DateField(blank=True, null=True)),
                ('gsa_confirmation_number', models.CharField(blank=True, max_length=50)),
                ('gsa_confirmation_date', models.DateField(blank=True, null=True)),
                ('payment_status', models.CharField(choices=[('not_due', 'Not Yet Due'), ('pending', 'Pending'), ('paid', 'Paid'), ('overdue', 'Overdue')], default='not_due', max_length=20)),
                ('payment_due_date', models.DateField(blank=True, null=True)),
                ('payment_date', models.DateField(blank=True, null=True)),
                ('payment_confirmation', models.CharField(blank=True, max_length=100)),
                ('payment_method', models.CharField(blank=True, help_text='Check, ACH, credit card, etc.', max_length=50)),
                ('submitted_report', models.FileField(blank=True, null=True, upload_to='extraction_reports/')),
                ('gsa_receipt', models.FileField(blank=True, null=True, upload_to='extraction_receipts/')),
                ('prepared_by', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('water_source', models.ForeignKey(limit_choices_to={'source_type': 'well'}, on_delete=django.db.models.deletion.CASCADE, related_name='extraction_reports', to='api.watersource')),
            ],
            options={
                'verbose_name': 'Extraction Report',
                'verbose_name_plural': 'Extraction Reports',
                'ordering': ['-period_start_date', 'water_source'],
                'unique_together': {('water_source', 'reporting_period')},
            },
        ),
        migrations.CreateModel(
            name='WellReading',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reading_date', models.DateField()),
                ('reading_time', models.TimeField(blank=True, null=True)),
                ('meter_reading', models.DecimalField(decimal_places=4, help_text='Actual meter totalizer reading', max_digits=15)),
                ('previous_reading', models.DecimalField(blank=True, decimal_places=4, help_text='Previous meter reading (auto-populated)', max_digits=15, null=True)),
                ('previous_reading_date', models.DateField(blank=True, help_text='Date of previous reading', null=True)),
                ('extraction_native_units', models.DecimalField(blank=True, decimal_places=4, help_text="Extraction in meter's native units", max_digits=15, null=True)),
                ('extraction_acre_feet', models.DecimalField(blank=True, decimal_places=6, help_text='Extraction converted to acre-feet', max_digits=12, null=True)),
                ('extraction_gallons', models.DecimalField(blank=True, decimal_places=2, help_text='Extraction converted to gallons', max_digits=15, null=True)),
                ('reading_type', models.CharField(choices=[('manual', 'Manual Reading'), ('ami_automatic', 'AMI Automatic'), ('estimated', 'Estimated'), ('initial', 'Initial Reading'), ('final', 'Final Reading')], default='manual', max_length=20)),
                ('meter_photo', models.ImageField(blank=True, help_text='Photo of meter face showing reading', null=True, upload_to='meter_readings/')),
                ('pump_hours', models.DecimalField(blank=True, decimal_places=2, help_text='Pump runtime hours (if hour meter installed)', max_digits=10, null=True)),
                ('water_level_ft', models.DecimalField(blank=True, decimal_places=2, help_text='Water level at time of reading (ft below surface)', max_digits=7, null=True)),
                ('recorded_by', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('water_source', models.ForeignKey(limit_choices_to={'source_type': 'well'}, on_delete=django.db.models.deletion.CASCADE, related_name='readings', to='api.watersource')),
            ],
            options={
                'ordering': ['-reading_date', '-reading_time'],
                'indexes': [models.Index(fields=['water_source', '-reading_date'], name='api_wellrea_water_s_5737c0_idx')],
            },
        ),
    ]
