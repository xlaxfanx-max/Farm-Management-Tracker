# Generated by Django 4.2 on 2026-02-18 22:20

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0067_rename_api_dettree_survey_idx_api_detecte_survey__2ce87c_idx_and_more'),
    ]

    operations = [
        migrations.AddField(
            model_name='correctiveaction',
            name='is_nuoca',
            field=models.BooleanField(default=False, help_text='Is this a NUOCA (Notice of Unusual Occurrence and Corrective Action)?'),
        ),
        migrations.AddField(
            model_name='correctiveaction',
            name='nuoca_category',
            field=models.CharField(blank=True, choices=[('food_safety_incident', 'Food Safety Incident'), ('contamination_suspected', 'Suspected Contamination'), ('animal_intrusion', 'Animal Intrusion'), ('chemical_spill', 'Chemical Spill'), ('equipment_failure', 'Equipment Failure'), ('worker_illness', 'Worker Illness/Injury'), ('water_system', 'Water System Issue'), ('product_rejection', 'Product Rejection'), ('flooding', 'Flooding Event'), ('security_breach', 'Security Breach'), ('other', 'Other Unusual Occurrence')], max_length=50),
        ),
        migrations.AddField(
            model_name='correctiveaction',
            name='occurrence_time',
            field=models.TimeField(blank=True, null=True),
        ),
        migrations.AddField(
            model_name='correctiveaction',
            name='reported_by_name',
            field=models.CharField(blank=True, max_length=200),
        ),
        migrations.AlterField(
            model_name='correctiveaction',
            name='source_type',
            field=models.CharField(default='audit', help_text='audit, mock_recall, inspection, incident, nuoca', max_length=50),
        ),
        migrations.CreateModel(
            name='WorkerTrainingSession',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('training_date', models.DateField()),
                ('training_topic', models.CharField(max_length=300)),
                ('training_category', models.CharField(choices=[('psa', 'Produce Safety Alliance'), ('animal_intrusion', 'Animal Intrusion'), ('food_safety', 'Food Safety & Security'), ('hygiene', 'Worker Health & Hygiene'), ('bleeding_illness', 'Bleeding/Bodily Fluids & Illness'), ('inspections', 'Internal & External Inspections'), ('crop_protection', 'Crop Protection / Pesticides'), ('emergency', 'Emergency Response'), ('food_defense', 'Food Defense'), ('other', 'Other')], max_length=30)),
                ('language', models.CharField(choices=[('english', 'English'), ('spanish', 'Spanish'), ('bilingual', 'Bilingual (English/Spanish)')], default='bilingual', max_length=20)),
                ('instructor_name', models.CharField(max_length=200)),
                ('instructor_title', models.CharField(blank=True, max_length=200)),
                ('duration_minutes', models.IntegerField(blank=True, null=True)),
                ('location', models.CharField(blank=True, max_length=200)),
                ('materials_used', models.TextField(blank=True)),
                ('attendees', models.JSONField(default=list, help_text='[{"name": "...", "employee_id": "", "role": "", "signature_date": ""}]')),
                ('attendee_count', models.IntegerField(default=0)),
                ('quiz_administered', models.BooleanField(default=False)),
                ('average_score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True)),
                ('sign_in_sheet', models.FileField(blank=True, help_text='Scanned sign-in sheet with signatures', null=True, upload_to='training_sessions/%Y/%m/')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_sessions', to='api.company')),
                ('farm', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='training_sessions', to='api.farm')),
                ('related_document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='api.controlleddocument')),
            ],
            options={
                'ordering': ['-training_date'],
            },
        ),
        migrations.CreateModel(
            name='TrainingRecord',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('employee_name', models.CharField(max_length=200)),
                ('employee_id', models.CharField(blank=True, max_length=50)),
                ('employee_role', models.CharField(blank=True, max_length=200)),
                ('psa_training_date', models.DateField(blank=True, null=True)),
                ('psa_certificate_number', models.CharField(blank=True, max_length=100)),
                ('animal_intrusion_date', models.DateField(blank=True, null=True)),
                ('animal_intrusion_expiration', models.DateField(blank=True, null=True)),
                ('food_safety_date', models.DateField(blank=True, null=True)),
                ('food_safety_expiration', models.DateField(blank=True, null=True)),
                ('worker_hygiene_date', models.DateField(blank=True, null=True)),
                ('worker_hygiene_expiration', models.DateField(blank=True, null=True)),
                ('bleeding_illness_date', models.DateField(blank=True, null=True)),
                ('bleeding_illness_expiration', models.DateField(blank=True, null=True)),
                ('inspections_date', models.DateField(blank=True, null=True)),
                ('inspections_expiration', models.DateField(blank=True, null=True)),
                ('crop_protection_date', models.DateField(blank=True, null=True)),
                ('crop_protection_expiration', models.DateField(blank=True, null=True)),
                ('applicator_license_number', models.CharField(blank=True, max_length=100)),
                ('applicator_license_expiration', models.DateField(blank=True, null=True)),
                ('additional_training', models.JSONField(blank=True, default=list, help_text='[{"topic": "...", "date": "2026-01-15", "expiration": "2027-01-15", "trainer": "..."}]')),
                ('active', models.BooleanField(default=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_records', to='api.company')),
                ('employee_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='training_records', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['employee_name'],
            },
        ),
        migrations.CreateModel(
            name='SupplierVerificationLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('verification_date', models.DateField()),
                ('verification_type', models.CharField(choices=[('crop_protection', 'Crop Protection Applicator'), ('labor_contractor', 'Labor Contractor'), ('toilet_service', 'Toilet/Handwash Service'), ('water_lab', 'Water Testing Laboratory'), ('packinghouse', 'Packinghouse'), ('fertilizer', 'Fertilizer Supplier'), ('other', 'Other')], max_length=30)),
                ('verified_by', models.CharField(max_length=200)),
                ('checklist_items', models.JSONField(default=list, help_text='[{"question": "...", "result": "yes/no/na", "notes": "..."}]')),
                ('overall_result', models.CharField(choices=[('passed', 'Passed'), ('failed', 'Failed'), ('conditional', 'Conditional')], default='passed', max_length=20)),
                ('deficiencies', models.TextField(blank=True)),
                ('corrective_action_required', models.BooleanField(default=False)),
                ('nuoca_filed', models.BooleanField(default=False)),
                ('next_verification_date', models.DateField(blank=True, null=True)),
                ('satisfied_with_service', models.BooleanField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='supplier_verifications', to='api.company')),
                ('corrective_action_ref', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supplier_verification_source', to='api.correctiveaction')),
                ('supplier', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='verifications', to='api.approvedsupplier')),
                ('verified_by_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supplier_verifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-verification_date'],
            },
        ),
        migrations.CreateModel(
            name='SanitationMaintenanceLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('log_date', models.DateField()),
                ('log_time', models.TimeField(blank=True, null=True)),
                ('unit_identifier', models.CharField(help_text='Unit number or location identifier', max_length=100)),
                ('paper_towels_stocked', models.BooleanField(default=False)),
                ('toilet_paper_stocked', models.BooleanField(default=False)),
                ('soap_available', models.BooleanField(default=False)),
                ('potable_water_available', models.BooleanField(default=False)),
                ('trash_removed', models.BooleanField(default=False)),
                ('restroom_cleaned', models.BooleanField(default=False)),
                ('condition_acceptable', models.BooleanField(default=True)),
                ('repairs_needed', models.BooleanField(default=False)),
                ('repairs_description', models.TextField(blank=True)),
                ('serviced_by', models.CharField(max_length=200)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sanitation_maintenance_logs', to='api.company')),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sanitation_maintenance_logs', to='api.farm')),
                ('serviced_by_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sanitation_maintenance_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-log_date'],
            },
        ),
        migrations.CreateModel(
            name='ProductHoldRelease',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('hold_number', models.CharField(blank=True, help_text='Auto-generated if blank', max_length=50)),
                ('hold_date', models.DateField()),
                ('hold_time', models.TimeField(blank=True, null=True)),
                ('product_type', models.CharField(choices=[('farm_input', 'Farm Input'), ('product', 'Product (Avocados)')], default='product', max_length=30)),
                ('product_description', models.CharField(max_length=300)),
                ('lot_numbers', models.JSONField(blank=True, default=list)),
                ('quantity', models.CharField(blank=True, max_length=100)),
                ('hold_reason', models.CharField(choices=[('contamination_suspected', 'Suspected Contamination'), ('pesticide_violation', 'Pesticide Violation'), ('water_quality', 'Water Quality Issue'), ('foreign_material', 'Foreign Material'), ('customer_complaint', 'Customer Complaint'), ('damaged_packaging', 'Damaged Packaging'), ('missing_documentation', 'Missing Documentation'), ('investigation', 'Under Investigation'), ('other', 'Other')], max_length=30)),
                ('hold_reason_detail', models.TextField()),
                ('hold_initiated_by', models.CharField(max_length=200)),
                ('segregation_method', models.TextField(blank=True, help_text='How affected product is segregated')),
                ('status', models.CharField(choices=[('on_hold', 'On Hold'), ('released', 'Released'), ('rejected', 'Rejected'), ('destroyed', 'Destroyed')], default='on_hold', max_length=20)),
                ('investigation_notes', models.TextField(blank=True)),
                ('release_date', models.DateField(blank=True, null=True)),
                ('release_time', models.TimeField(blank=True, null=True)),
                ('release_authorized_by', models.CharField(blank=True, max_length=200)),
                ('disposition', models.TextField(blank=True, help_text='Actions taken on product')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='product_holds', to='api.company')),
                ('corrective_action_ref', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='product_hold_source', to='api.correctiveaction')),
                ('farm', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='product_holds', to='api.farm')),
            ],
            options={
                'ordering': ['-hold_date'],
            },
        ),
        migrations.CreateModel(
            name='PreSeasonChecklist',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('season_year', models.IntegerField()),
                ('assessment_date', models.DateField()),
                ('assessed_by', models.CharField(max_length=200)),
                ('non_ag_previous_use', models.BooleanField(blank=True, null=True)),
                ('animal_husbandry_previous', models.BooleanField(blank=True, null=True)),
                ('waste_storage_previous', models.BooleanField(blank=True, null=True)),
                ('animal_activity_evidence', models.BooleanField(blank=True, null=True)),
                ('flooding_occurred', models.BooleanField(blank=True, null=True)),
                ('new_purchase_or_lease', models.BooleanField(blank=True, null=True)),
                ('ground_history_notes', models.TextField(blank=True)),
                ('adjacent_livestock', models.BooleanField(blank=True, null=True)),
                ('adjacent_manure_storage', models.BooleanField(blank=True, null=True)),
                ('adjacent_land_notes', models.TextField(blank=True)),
                ('raw_manure_used', models.BooleanField(blank=True, null=True)),
                ('biosolids_used', models.BooleanField(blank=True, null=True)),
                ('composted_manure_used', models.BooleanField(blank=True, null=True)),
                ('heat_treated_manure_used', models.BooleanField(blank=True, null=True)),
                ('soil_amendments_used', models.BooleanField(blank=True, null=True)),
                ('nonsynthetic_treatments_used', models.BooleanField(blank=True, null=True)),
                ('fertilizer_storage_safe', models.BooleanField(blank=True, null=True)),
                ('fertilizer_notes', models.TextField(blank=True)),
                ('water_sources', models.JSONField(blank=True, default=list, help_text='["municipal", "well", "reservoir", "surface", "reclaimed"]')),
                ('microbial_tests_conducted', models.BooleanField(blank=True, null=True)),
                ('backflow_prevention_in_use', models.BooleanField(blank=True, null=True)),
                ('water_delivery_good_condition', models.BooleanField(blank=True, null=True)),
                ('water_risk_factors_identified', models.BooleanField(blank=True, null=True)),
                ('water_risk_factors_detail', models.TextField(blank=True)),
                ('water_notes', models.TextField(blank=True)),
                ('toilet_facilities_available', models.BooleanField(blank=True, null=True)),
                ('toilet_facilities_maintained', models.BooleanField(blank=True, null=True)),
                ('workers_trained', models.BooleanField(blank=True, null=True)),
                ('first_aid_current', models.BooleanField(blank=True, null=True)),
                ('access_roads_safe', models.BooleanField(blank=True, null=True)),
                ('toilet_location_suitable', models.BooleanField(blank=True, null=True)),
                ('service_company_procedures', models.BooleanField(blank=True, null=True)),
                ('hygiene_notes', models.TextField(blank=True)),
                ('pca_qal_license_current', models.BooleanField(blank=True, null=True)),
                ('letters_of_guarantee_current', models.BooleanField(blank=True, null=True)),
                ('pesticide_use_reports_current', models.BooleanField(blank=True, null=True)),
                ('water_tests_current', models.BooleanField(blank=True, null=True)),
                ('perimeter_monitoring_log_current', models.BooleanField(blank=True, null=True)),
                ('restroom_maintenance_log_current', models.BooleanField(blank=True, null=True)),
                ('training_log_current', models.BooleanField(blank=True, null=True)),
                ('committee_log_current', models.BooleanField(blank=True, null=True)),
                ('management_review_current', models.BooleanField(blank=True, null=True)),
                ('fertilizer_log_current', models.BooleanField(blank=True, null=True)),
                ('nuoca_forms_current', models.BooleanField(blank=True, null=True)),
                ('chemical_inventory_current', models.BooleanField(blank=True, null=True)),
                ('records_notes', models.TextField(blank=True)),
                ('deficiencies_found', models.BooleanField(default=False)),
                ('deficiency_list', models.JSONField(blank=True, default=list, help_text='[{"item": "...", "corrective_action": "...", "due_date": "..."}]')),
                ('approved_for_season', models.BooleanField(default=False)),
                ('approved_by', models.CharField(blank=True, max_length=200)),
                ('approval_date', models.DateField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assessed_by_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='pre_season_checklists', to=settings.AUTH_USER_MODEL)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pre_season_checklists', to='api.company')),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='pre_season_checklists', to='api.farm')),
            ],
            options={
                'ordering': ['-season_year'],
            },
        ),
        migrations.CreateModel(
            name='PerimeterMonitoringLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('log_date', models.DateField()),
                ('week_number', models.IntegerField(help_text='ISO week number (1-53), auto-calculated')),
                ('inspector_name', models.CharField(max_length=200)),
                ('perimeter_intact', models.BooleanField(blank=True, null=True)),
                ('gates_secured', models.BooleanField(blank=True, null=True)),
                ('signage_in_place', models.BooleanField(blank=True, null=True)),
                ('animal_activity_found', models.BooleanField(default=False)),
                ('animal_species_observed', models.CharField(blank=True, max_length=300)),
                ('fecal_matter_found', models.BooleanField(default=False)),
                ('fecal_matter_action', models.TextField(blank=True)),
                ('animal_carcass_found', models.BooleanField(default=False)),
                ('crop_damage_from_animals', models.BooleanField(default=False)),
                ('buffer_zones_clear', models.BooleanField(blank=True, null=True)),
                ('water_sources_checked', models.JSONField(blank=True, default=list, help_text='[{"source_name": "...", "type": "well/reservoir/etc", "condition": "ok/issue", "access_secure": true, "notes": ""}]')),
                ('water_source_integrity_ok', models.BooleanField(blank=True, null=True)),
                ('unauthorized_access_found', models.BooleanField(default=False)),
                ('unauthorized_access_notes', models.TextField(blank=True)),
                ('trespassing_evidence', models.BooleanField(default=False)),
                ('trash_found', models.BooleanField(default=False)),
                ('corrective_action_needed', models.BooleanField(default=False)),
                ('corrective_action_description', models.TextField(blank=True)),
                ('findings_summary', models.TextField(blank=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='perimeter_logs', to='api.company')),
                ('corrective_action_ref', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='perimeter_log_source', to='api.correctiveaction')),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='perimeter_logs', to='api.farm')),
                ('inspector', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='perimeter_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-log_date'],
            },
        ),
        migrations.CreateModel(
            name='ManagementVerificationReview',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('review_year', models.IntegerField()),
                ('review_date', models.DateField()),
                ('conducted_by', models.CharField(max_length=200)),
                ('conducted_by_title', models.CharField(blank=True, max_length=200)),
                ('internal_audits_reviewed', models.BooleanField(default=False)),
                ('internal_audits_analysis', models.TextField(blank=True)),
                ('internal_audits_comments', models.TextField(blank=True)),
                ('external_audits_reviewed', models.BooleanField(default=False)),
                ('external_audits_analysis', models.TextField(blank=True)),
                ('external_audits_comments', models.TextField(blank=True)),
                ('incidents_reviewed', models.BooleanField(default=False)),
                ('incidents_analysis', models.TextField(blank=True)),
                ('incidents_comments', models.TextField(blank=True)),
                ('complaints_reviewed', models.BooleanField(default=False)),
                ('complaints_analysis', models.TextField(blank=True)),
                ('complaints_comments', models.TextField(blank=True)),
                ('objectives_reviewed', models.BooleanField(default=False)),
                ('objectives_analysis', models.TextField(blank=True)),
                ('objectives_comments', models.TextField(blank=True)),
                ('org_structure_reviewed', models.BooleanField(default=False)),
                ('org_structure_analysis', models.TextField(blank=True)),
                ('org_structure_comments', models.TextField(blank=True)),
                ('sops_reviewed', models.BooleanField(default=False)),
                ('sops_analysis', models.TextField(blank=True)),
                ('sops_comments', models.TextField(blank=True)),
                ('training_reviewed', models.BooleanField(default=False)),
                ('training_analysis', models.TextField(blank=True)),
                ('training_comments', models.TextField(blank=True)),
                ('equipment_reviewed', models.BooleanField(default=False)),
                ('equipment_analysis', models.TextField(blank=True)),
                ('equipment_comments', models.TextField(blank=True)),
                ('job_roles_reviewed', models.BooleanField(default=False)),
                ('job_roles_analysis', models.TextField(blank=True)),
                ('job_roles_comments', models.TextField(blank=True)),
                ('supplier_program_reviewed', models.BooleanField(default=False)),
                ('supplier_program_analysis', models.TextField(blank=True)),
                ('supplier_program_comments', models.TextField(blank=True)),
                ('committee_reviewed', models.BooleanField(default=False)),
                ('committee_analysis', models.TextField(blank=True)),
                ('committee_comments', models.TextField(blank=True)),
                ('resources_adequate', models.BooleanField(blank=True, null=True)),
                ('resource_gaps', models.TextField(blank=True)),
                ('resource_allocation_plan', models.TextField(blank=True)),
                ('overall_assessment', models.TextField(blank=True)),
                ('action_items', models.JSONField(blank=True, default=list, help_text='[{"item": "...", "assigned_to": "...", "due_date": "...", "status": "open"}]')),
                ('attendees', models.JSONField(blank=True, default=list, help_text='[{"name": "...", "title": "...", "signed": true}]')),
                ('approved', models.BooleanField(default=False)),
                ('approved_by', models.CharField(blank=True, max_length=200)),
                ('approved_date', models.DateField(blank=True, null=True)),
                ('next_review_date', models.DateField(blank=True, null=True)),
                ('report_file', models.FileField(blank=True, null=True, upload_to='management_reviews/%Y/')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='management_reviews', to='api.company')),
            ],
            options={
                'ordering': ['-review_year'],
            },
        ),
        migrations.CreateModel(
            name='FoodSafetyRoleAssignment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role_category', models.CharField(choices=[('owner', 'Owner / Grower'), ('coordinator', 'Food Safety Coordinator'), ('alternate_coordinator', 'Alternate Coordinator'), ('committee_member', 'Committee Member'), ('manager', 'Manager / Foreman'), ('supervisor', 'Supervisor'), ('irrigator', 'Irrigator'), ('applicator', 'Pesticide Applicator'), ('worker', 'Worker'), ('other', 'Other')], max_length=30)),
                ('role_title', models.CharField(help_text='e.g., Owner / Grower', max_length=200)),
                ('person_name', models.CharField(max_length=200)),
                ('alternate_name', models.CharField(blank=True, max_length=200)),
                ('responsibilities', models.JSONField(blank=True, default=list, help_text='["Oversees food safety and security", "Responsible for paperwork upkeep"]')),
                ('active', models.BooleanField(default=True)),
                ('display_order', models.IntegerField(default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='food_safety_roles', to='api.company')),
                ('person_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='food_safety_roles', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['display_order', 'role_category'],
            },
        ),
        migrations.CreateModel(
            name='FoodSafetyProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('coordinator_name', models.CharField(blank=True, max_length=200)),
                ('coordinator_title', models.CharField(blank=True, max_length=200)),
                ('coordinator_phone', models.CharField(blank=True, max_length=50)),
                ('coordinator_email', models.EmailField(blank=True, max_length=254)),
                ('alternate_coordinator_name', models.CharField(blank=True, max_length=200)),
                ('alternate_coordinator_phone', models.CharField(blank=True, max_length=50)),
                ('policy_statement', models.TextField(blank=True, help_text="The company's food safety policy â€” must be posted in a public area")),
                ('policy_effective_date', models.DateField(blank=True, null=True)),
                ('policy_reviewed_date', models.DateField(blank=True, null=True)),
                ('policy_approved_by', models.CharField(blank=True, max_length=200)),
                ('policy_approved_title', models.CharField(blank=True, max_length=200)),
                ('commodities_grown', models.JSONField(blank=True, default=list, help_text='["Avocados", "Lemons"]')),
                ('total_planted_acres', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('ranch_map_file', models.FileField(blank=True, help_text='Aerial image/map showing water fixtures, crops, fields', null=True, upload_to='food_safety_profiles/%Y/')),
                ('last_reviewed_date', models.DateField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='food_safety_profile', to='api.company')),
            ],
            options={
                'verbose_name': 'Food Safety Profile',
            },
        ),
        migrations.CreateModel(
            name='FoodSafetyCommitteeMeeting',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('meeting_date', models.DateField()),
                ('meeting_time', models.TimeField(blank=True, null=True)),
                ('meeting_quarter', models.CharField(choices=[('Q1', 'Q1 (Jan-Mar)'), ('Q2', 'Q2 (Apr-Jun)'), ('Q3', 'Q3 (Jul-Sep)'), ('Q4', 'Q4 (Oct-Dec)')], max_length=2)),
                ('meeting_year', models.IntegerField()),
                ('location', models.CharField(blank=True, max_length=200)),
                ('attendees', models.JSONField(default=list, help_text='[{"name": "...", "title": "...", "signed": true}]')),
                ('animal_activity_reviewed', models.BooleanField(default=False)),
                ('animal_activity_notes', models.TextField(blank=True)),
                ('pesticide_apps_reviewed', models.BooleanField(default=False)),
                ('pesticide_apps_notes', models.TextField(blank=True)),
                ('pesticide_records_in_binder', models.BooleanField(blank=True, null=True)),
                ('phi_followed', models.BooleanField(blank=True, null=True)),
                ('fertilizer_apps_reviewed', models.BooleanField(default=False)),
                ('fertilizer_apps_notes', models.TextField(blank=True)),
                ('fertilizer_records_in_binder', models.BooleanField(blank=True, null=True)),
                ('water_testing_reviewed', models.BooleanField(default=False)),
                ('water_testing_notes', models.TextField(blank=True)),
                ('last_irrigation_water_test', models.DateField(blank=True, null=True)),
                ('last_handwash_water_test', models.DateField(blank=True, null=True)),
                ('water_records_current', models.BooleanField(blank=True, null=True)),
                ('worker_training_reviewed', models.BooleanField(default=False)),
                ('worker_training_notes', models.TextField(blank=True)),
                ('last_pesticide_training', models.DateField(blank=True, null=True)),
                ('last_food_safety_training', models.DateField(blank=True, null=True)),
                ('additional_topics', models.TextField(blank=True)),
                ('action_items', models.JSONField(blank=True, default=list, help_text='[{"item": "...", "assigned_to": "...", "due_date": "...", "status": "open"}]')),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('completed', 'Completed')], default='draft', max_length=20)),
                ('coordinator_signature_date', models.DateField(blank=True, null=True)),
                ('next_meeting_date', models.DateField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='committee_meetings', to='api.company')),
                ('farm', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='committee_meetings', to='api.farm')),
            ],
            options={
                'ordering': ['-meeting_date'],
            },
        ),
        migrations.CreateModel(
            name='FoodFraudAssessment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('assessment_year', models.IntegerField()),
                ('assessment_date', models.DateField()),
                ('assessed_by', models.CharField(max_length=200)),
                ('fraud_assessments', models.JSONField(default=list, help_text='[{"fraud_type": "substitution", "location": "Harvest and Transportation", "description": "...", "significant": true, "likelihood": "low", "severity": "...", "preventive_measures": "...", "supporting_docs": "..."}]')),
                ('overall_vulnerability', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High')], default='low', max_length=20)),
                ('mitigation_summary', models.TextField(blank=True)),
                ('reviewed_date', models.DateField(blank=True, null=True)),
                ('approved', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='food_fraud_assessments', to='api.company')),
                ('related_document', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='api.controlleddocument')),
            ],
            options={
                'ordering': ['-assessment_year'],
            },
        ),
        migrations.CreateModel(
            name='FieldRiskAssessment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('assessment_date', models.DateField()),
                ('season_year', models.IntegerField()),
                ('assessed_by', models.CharField(max_length=200)),
                ('total_acres', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('crops_grown', models.JSONField(blank=True, default=list)),
                ('structures_on_property', models.TextField(blank=True)),
                ('previous_land_use', models.CharField(blank=True, max_length=300)),
                ('recent_flood_event', models.BooleanField(blank=True, null=True)),
                ('adjacent_land_use', models.TextField(blank=True)),
                ('land_contamination_risks', models.JSONField(blank=True, default=list, help_text='Risks from structures, animals, previous land use, flooding')),
                ('water_source_risks', models.JSONField(blank=True, default=list, help_text='Risks per water source type (well, district, reservoir, creek, reclaimed)')),
                ('agricultural_input_risks', models.JSONField(blank=True, default=list, help_text='Risks from fertilizers, soil amendments, pesticides')),
                ('worker_hygiene_risks', models.JSONField(blank=True, default=list, help_text='Risks from toilet/handwash facilities, worker contamination, equipment')),
                ('labor_harvesting_risks', models.JSONField(blank=True, default=list, help_text='Risks from worker practices, equipment, foreign materials')),
                ('water_sources_description', models.TextField(blank=True)),
                ('water_tests_conducted', models.BooleanField(blank=True, null=True)),
                ('fertilizer_suppliers', models.TextField(blank=True)),
                ('pesticide_suppliers', models.TextField(blank=True)),
                ('animal_amendments_used', models.BooleanField(blank=True, null=True)),
                ('toilet_type', models.CharField(blank=True, help_text='permanent/portable/na', max_length=30)),
                ('maintenance_provider', models.CharField(blank=True, max_length=200)),
                ('labor_hired_by', models.CharField(blank=True, max_length=100)),
                ('harvest_arranged_by', models.CharField(blank=True, max_length=100)),
                ('harvest_crew_certified', models.BooleanField(blank=True, null=True)),
                ('overall_risk_level', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('critical', 'Critical')], default='low', max_length=20)),
                ('critical_risks_count', models.IntegerField(default=0)),
                ('high_risks_count', models.IntegerField(default=0)),
                ('reviewed_by', models.CharField(blank=True, max_length=200)),
                ('review_date', models.DateField(blank=True, null=True)),
                ('approved', models.BooleanField(default=False)),
                ('report_file', models.FileField(blank=True, null=True, upload_to='field_risk_assessments/%Y/')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assessed_by_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='field_risk_assessments', to=settings.AUTH_USER_MODEL)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='field_risk_assessments', to='api.company')),
                ('farm', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='field_risk_assessments', to='api.farm')),
                ('field', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='field_risk_assessments', to='api.field')),
            ],
            options={
                'ordering': ['-assessment_date'],
            },
        ),
        migrations.CreateModel(
            name='EmployeeNonConformance',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('employee_name', models.CharField(max_length=200)),
                ('employee_id', models.CharField(blank=True, max_length=50)),
                ('violation_date', models.DateField()),
                ('violation_type', models.CharField(choices=[('hygiene', 'Hygiene Violation'), ('food_safety_procedure', 'Food Safety Procedure Violation'), ('ppe', 'PPE Violation'), ('restricted_area', 'Restricted Area Violation'), ('toilet_use', 'Toilet Use Violation'), ('eating_smoking', 'Eating/Smoking in Growing Area'), ('other', 'Other')], max_length=30)),
                ('violation_description', models.TextField()),
                ('supervisor_name', models.CharField(max_length=200)),
                ('warning_level', models.IntegerField(choices=[(1, '1st Warning (Verbal)'), (2, '2nd Warning (Written)'), (3, '3rd Warning (Disciplinary)')], default=1)),
                ('warning_description', models.TextField(blank=True)),
                ('employee_acknowledged', models.BooleanField(default=False)),
                ('employee_signature_date', models.DateField(blank=True, null=True)),
                ('follow_up_required', models.BooleanField(default=False)),
                ('follow_up_date', models.DateField(blank=True, null=True)),
                ('follow_up_notes', models.TextField(blank=True)),
                ('resolved', models.BooleanField(default=False)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='employee_non_conformances', to='api.company')),
                ('employee_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='non_conformances', to=settings.AUTH_USER_MODEL)),
                ('supervisor_user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='supervised_non_conformances', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-violation_date'],
            },
        ),
        migrations.CreateModel(
            name='EmergencyContact',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contact_type', models.CharField(choices=[('fire', 'Fire Department'), ('police', 'Police / Sheriff'), ('ambulance', 'Ambulance / EMS'), ('hospital', 'Hospital'), ('poison_control', 'Poison Control'), ('county_ag', 'County Agricultural Commissioner'), ('dpr', 'Dept. of Pesticide Regulation'), ('epa', 'EPA'), ('fda', 'FDA'), ('cdfa', 'CDFA'), ('usda', 'USDA'), ('cdc', 'CDC'), ('utility', 'Utility Company'), ('packinghouse', 'Packinghouse'), ('company_management', 'Company Management'), ('food_safety_coordinator', 'Food Safety Coordinator'), ('other', 'Other')], max_length=30)),
                ('organization', models.CharField(max_length=300)),
                ('contact_name', models.CharField(blank=True, max_length=200)),
                ('phone_primary', models.CharField(max_length=50)),
                ('phone_secondary', models.CharField(blank=True, max_length=50)),
                ('address', models.TextField(blank=True)),
                ('notes', models.CharField(blank=True, max_length=300)),
                ('display_order', models.IntegerField(default=0)),
                ('active', models.BooleanField(default=True)),
                ('last_verified_date', models.DateField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='emergency_contacts', to='api.company')),
            ],
            options={
                'ordering': ['display_order', 'contact_type'],
            },
        ),
        migrations.CreateModel(
            name='ChemicalInventoryLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('chemical_name', models.CharField(max_length=300)),
                ('epa_registration_number', models.CharField(blank=True, max_length=100)),
                ('chemical_type', models.CharField(choices=[('herbicide', 'Herbicide'), ('insecticide', 'Insecticide'), ('fungicide', 'Fungicide'), ('rodenticide', 'Rodenticide'), ('fumigant', 'Fumigant'), ('adjuvant', 'Adjuvant'), ('growth_regulator', 'Growth Regulator'), ('other', 'Other')], max_length=30)),
                ('storage_location', models.CharField(blank=True, max_length=200)),
                ('unit_of_measure', models.CharField(choices=[('gallons', 'Gallons'), ('pounds', 'Pounds'), ('ounces', 'Ounces'), ('liters', 'Liters'), ('kilograms', 'Kilograms'), ('units', 'Units')], default='gallons', max_length=30)),
                ('inventory_date', models.DateField(help_text='Date of inventory count')),
                ('inventory_month', models.IntegerField(help_text='Month (1-12)')),
                ('inventory_year', models.IntegerField()),
                ('stock_on_hand', models.DecimalField(decimal_places=2, max_digits=10)),
                ('counted_by', models.CharField(max_length=200)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chemical_inventory_logs', to='api.company')),
            ],
            options={
                'ordering': ['-inventory_date'],
            },
        ),
        migrations.AddIndex(
            model_name='workertrainingsession',
            index=models.Index(fields=['company', '-training_date'], name='idx_trainsess_company_date'),
        ),
        migrations.AddIndex(
            model_name='workertrainingsession',
            index=models.Index(fields=['company', 'training_category'], name='idx_trainsess_company_cat'),
        ),
        migrations.AddIndex(
            model_name='trainingrecord',
            index=models.Index(fields=['company', 'active'], name='idx_trainrec_company_active'),
        ),
        migrations.AddIndex(
            model_name='supplierverificationlog',
            index=models.Index(fields=['company', '-verification_date'], name='idx_suppverify_company_date'),
        ),
        migrations.AddIndex(
            model_name='sanitationmaintenancelog',
            index=models.Index(fields=['company', 'farm', '-log_date'], name='idx_sanmaint_company_farm'),
        ),
        migrations.AddIndex(
            model_name='productholdrelease',
            index=models.Index(fields=['company', 'status'], name='idx_prodhold_company_status'),
        ),
        migrations.AddIndex(
            model_name='preseasonchecklist',
            index=models.Index(fields=['company', 'farm', '-season_year'], name='idx_preseason_company_farm_yr'),
        ),
        migrations.AddConstraint(
            model_name='preseasonchecklist',
            constraint=models.UniqueConstraint(fields=('farm', 'season_year'), name='unique_preseason_per_farm_year'),
        ),
        migrations.AddIndex(
            model_name='perimetermonitoringlog',
            index=models.Index(fields=['company', 'farm', '-log_date'], name='idx_perimeter_company_farm'),
        ),
        migrations.AddIndex(
            model_name='perimetermonitoringlog',
            index=models.Index(fields=['farm', 'week_number'], name='idx_perimeter_farm_week'),
        ),
        migrations.AddConstraint(
            model_name='perimetermonitoringlog',
            constraint=models.UniqueConstraint(fields=('farm', 'log_date'), name='unique_perimeter_log_per_farm_date'),
        ),
        migrations.AddIndex(
            model_name='managementverificationreview',
            index=models.Index(fields=['company', '-review_year'], name='idx_mgmtreview_company_year'),
        ),
        migrations.AddConstraint(
            model_name='managementverificationreview',
            constraint=models.UniqueConstraint(fields=('company', 'review_year'), name='unique_management_review_per_year'),
        ),
        migrations.AddIndex(
            model_name='foodsafetyroleassignment',
            index=models.Index(fields=['company', 'active'], name='idx_fsrole_company_active'),
        ),
        migrations.AddIndex(
            model_name='foodsafetycommitteemeeting',
            index=models.Index(fields=['company', '-meeting_date'], name='idx_committee_company_date'),
        ),
        migrations.AddIndex(
            model_name='foodsafetycommitteemeeting',
            index=models.Index(fields=['company', 'meeting_year', 'meeting_quarter'], name='idx_committee_year_quarter'),
        ),
        migrations.AddConstraint(
            model_name='foodsafetycommitteemeeting',
            constraint=models.UniqueConstraint(fields=('company', 'meeting_year', 'meeting_quarter'), name='unique_committee_meeting_per_quarter'),
        ),
        migrations.AddConstraint(
            model_name='foodfraudassessment',
            constraint=models.UniqueConstraint(fields=('company', 'assessment_year'), name='unique_fraud_assessment_per_year'),
        ),
        migrations.AddIndex(
            model_name='fieldriskassessment',
            index=models.Index(fields=['company', 'farm', '-season_year'], name='idx_fieldrisk_company_farm_yr'),
        ),
        migrations.AddConstraint(
            model_name='fieldriskassessment',
            constraint=models.UniqueConstraint(fields=('farm', 'season_year'), name='unique_field_risk_per_farm_year'),
        ),
        migrations.AddIndex(
            model_name='employeenonconformance',
            index=models.Index(fields=['company', '-violation_date'], name='idx_empnc_company_date'),
        ),
        migrations.AddIndex(
            model_name='emergencycontact',
            index=models.Index(fields=['company', 'active'], name='idx_emcontact_company_active'),
        ),
        migrations.AddIndex(
            model_name='chemicalinventorylog',
            index=models.Index(fields=['company', '-inventory_date'], name='idx_cheminv_company_date'),
        ),
        migrations.AddIndex(
            model_name='chemicalinventorylog',
            index=models.Index(fields=['company', 'chemical_name', 'inventory_year'], name='idx_cheminv_chem_year'),
        ),
    ]
