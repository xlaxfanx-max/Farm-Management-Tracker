# Generated by Django 4.2 on 2025-12-17 00:32

from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0002_farm_company'),
    ]

    operations = [
        migrations.CreateModel(
            name='Well',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('well_name', models.CharField(blank=True, help_text='Common name for the well', max_length=100)),
                ('state_well_number', models.CharField(blank=True, help_text='California DWR State Well Number (e.g., 04N21W36H001S)', max_length=50)),
                ('local_well_id', models.CharField(blank=True, help_text='County well permit number', max_length=50)),
                ('gsa_well_id', models.CharField(blank=True, help_text='GSA-assigned well identifier', max_length=50)),
                ('gsa', models.CharField(choices=[('obgma', 'Ojai Basin Groundwater Management Agency (OBGMA)'), ('fpbgsa', 'Fillmore and Piru Basins GSA'), ('uvrga', 'Upper Ventura River Groundwater Agency'), ('fcgma', 'Fox Canyon Groundwater Management Agency'), ('other', 'Other'), ('none', 'Not in GSA Jurisdiction')], default='obgma', help_text='Groundwater Sustainability Agency managing this well', max_length=20)),
                ('gsa_account_number', models.CharField(blank=True, help_text='Account number with the GSA for billing/reporting', max_length=50)),
                ('basin', models.CharField(choices=[('ojai_valley', 'Ojai Valley (4-002)'), ('upper_ventura_river', 'Upper Ventura River (4-003.01)'), ('lower_ventura_river', 'Lower Ventura River (4-003.02)'), ('fillmore', 'Santa Clara River Valley - Fillmore (4-004.05)'), ('piru', 'Santa Clara River Valley - Piru (4-004.06)'), ('santa_paula', 'Santa Clara River Valley - Santa Paula (4-004.04)'), ('oxnard', 'Santa Clara River Valley - Oxnard (4-004.02)'), ('pleasant_valley', 'Pleasant Valley (4-006)'), ('las_posas', 'Las Posas Valley (4-008)'), ('arroyo_santa_rosa', 'Arroyo Santa Rosa Valley (4-007)'), ('mound', 'Mound (4-004.01)'), ('other', 'Other')], default='ojai_valley', help_text='DWR Bulletin 118 groundwater basin', max_length=30)),
                ('basin_priority', models.CharField(choices=[('critical', 'Critically Overdrafted'), ('high', 'High Priority'), ('medium', 'Medium Priority'), ('low', 'Low Priority'), ('very_low', 'Very Low Priority')], default='medium', help_text='DWR basin priority classification', max_length=20)),
                ('well_depth_ft', models.DecimalField(blank=True, decimal_places=2, help_text='Total well depth in feet', max_digits=7, null=True)),
                ('casing_diameter_inches', models.DecimalField(blank=True, decimal_places=2, help_text='Well casing diameter in inches', max_digits=5, null=True)),
                ('screen_interval_top_ft', models.DecimalField(blank=True, decimal_places=2, help_text='Top of perforated/screened interval (ft below ground)', max_digits=7, null=True)),
                ('screen_interval_bottom_ft', models.DecimalField(blank=True, decimal_places=2, help_text='Bottom of perforated/screened interval (ft below ground)', max_digits=7, null=True)),
                ('static_water_level_ft', models.DecimalField(blank=True, decimal_places=2, help_text='Static water level (ft below ground surface)', max_digits=7, null=True)),
                ('static_level_date', models.DateField(blank=True, help_text='Date static water level was measured', null=True)),
                ('aquifer_name', models.CharField(blank=True, help_text='Name of aquifer (e.g., Upper Aquifer, San Pedro Formation)', max_length=100)),
                ('gps_latitude', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True)),
                ('gps_longitude', models.DecimalField(blank=True, decimal_places=7, max_digits=10, null=True)),
                ('township', models.CharField(blank=True, max_length=10)),
                ('range_value', models.CharField(blank=True, max_length=10)),
                ('section', models.CharField(blank=True, max_length=10)),
                ('quarter_quarter', models.CharField(blank=True, help_text='Quarter-quarter section (e.g., NE/SW)', max_length=10)),
                ('parcel_apn', models.CharField(blank=True, help_text="Assessor's Parcel Number", max_length=20)),
                ('pump_type', models.CharField(blank=True, choices=[('submersible', 'Submersible'), ('turbine', 'Vertical Turbine'), ('jet', 'Jet Pump'), ('centrifugal', 'Centrifugal'), ('other', 'Other')], max_length=20)),
                ('pump_horsepower', models.DecimalField(blank=True, decimal_places=2, help_text='Pump motor horsepower', max_digits=6, null=True)),
                ('pump_flow_rate_gpm', models.DecimalField(blank=True, decimal_places=2, help_text='Pump flow rate in gallons per minute (GPM)', max_digits=8, null=True)),
                ('pump_efficiency', models.DecimalField(blank=True, decimal_places=2, help_text='Pump efficiency percentage', max_digits=5, null=True)),
                ('pump_installation_date', models.DateField(blank=True, null=True)),
                ('pump_manufacturer', models.CharField(blank=True, max_length=100)),
                ('pump_model', models.CharField(blank=True, max_length=100)),
                ('power_source', models.CharField(blank=True, choices=[('electric_utility', 'Electric - Utility'), ('electric_solar', 'Electric - Solar'), ('diesel', 'Diesel Engine'), ('natural_gas', 'Natural Gas Engine'), ('propane', 'Propane Engine'), ('other', 'Other')], max_length=20)),
                ('utility_meter_number', models.CharField(blank=True, help_text='Electric utility meter number', max_length=50)),
                ('has_flowmeter', models.BooleanField(default=True, help_text='Is a flowmeter installed on this well?')),
                ('flowmeter_make', models.CharField(blank=True, max_length=100)),
                ('flowmeter_model', models.CharField(blank=True, max_length=100)),
                ('flowmeter_serial_number', models.CharField(blank=True, max_length=100)),
                ('flowmeter_size_inches', models.DecimalField(blank=True, decimal_places=2, help_text='Flowmeter pipe size in inches', max_digits=4, null=True)),
                ('flowmeter_installation_date', models.DateField(blank=True, null=True)),
                ('flowmeter_units', models.CharField(choices=[('acre_feet', 'Acre-Feet'), ('gallons', 'Gallons'), ('hundred_gallons', 'Hundred Gallons'), ('thousand_gallons', 'Thousand Gallons'), ('cubic_feet', 'Cubic Feet'), ('hundred_cubic_feet', 'Hundred Cubic Feet (CCF)')], default='acre_feet', max_length=20)),
                ('flowmeter_multiplier', models.DecimalField(decimal_places=4, default=1.0, help_text='Multiplier to convert meter reading to actual units', max_digits=10)),
                ('flowmeter_decimal_places', models.IntegerField(default=2, help_text='Number of decimal places on meter display')),
                ('has_ami', models.BooleanField(default=False, help_text='Is the well equipped with AMI (automated meter reading)?')),
                ('ami_vendor', models.CharField(blank=True, help_text='AMI vendor (e.g., Ranch Systems)', max_length=100)),
                ('ami_device_id', models.CharField(blank=True, max_length=100)),
                ('ami_installation_date', models.DateField(blank=True, null=True)),
                ('well_construction_date', models.DateField(blank=True, help_text='Date well was drilled/constructed', null=True)),
                ('well_permit_date', models.DateField(blank=True, null=True)),
                ('well_permit_number', models.CharField(blank=True, max_length=50)),
                ('driller_name', models.CharField(blank=True, max_length=100)),
                ('driller_license', models.CharField(blank=True, max_length=50)),
                ('well_log_available', models.BooleanField(default=False, help_text='Is well completion report/log on file?')),
                ('well_log_file', models.FileField(blank=True, null=True, upload_to='well_logs/')),
                ('status', models.CharField(choices=[('active', 'Active'), ('inactive', 'Inactive'), ('standby', 'Standby/Emergency'), ('destroyed', 'Destroyed/Abandoned'), ('monitoring', 'Monitoring Only')], default='active', max_length=20)),
                ('is_de_minimis', models.BooleanField(default=False, help_text='Domestic well extracting < 2 AF/year (exempt from most SGMA reporting)')),
                ('registered_with_gsa', models.BooleanField(default=False)),
                ('gsa_registration_date', models.DateField(blank=True, null=True)),
                ('meter_calibration_current', models.BooleanField(default=False)),
                ('next_calibration_due', models.DateField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('water_source', models.OneToOneField(limit_choices_to={'source_type': 'well'}, on_delete=django.db.models.deletion.CASCADE, related_name='well_details', to='api.watersource')),
            ],
            options={
                'verbose_name_plural': 'Wells',
                'ordering': ['water_source__farm__name', 'well_name'],
            },
        ),
        migrations.CreateModel(
            name='WellReading',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reading_date', models.DateField()),
                ('reading_time', models.TimeField(blank=True, null=True)),
                ('meter_reading', models.DecimalField(decimal_places=4, help_text='Actual meter totalizer reading', max_digits=15)),
                ('previous_reading', models.DecimalField(blank=True, decimal_places=4, help_text='Previous meter reading (auto-populated)', max_digits=15, null=True)),
                ('previous_reading_date', models.DateField(blank=True, help_text='Date of previous reading', null=True)),
                ('extraction_native_units', models.DecimalField(blank=True, decimal_places=4, help_text="Extraction in meter's native units", max_digits=15, null=True)),
                ('extraction_acre_feet', models.DecimalField(blank=True, decimal_places=6, help_text='Extraction converted to acre-feet', max_digits=12, null=True)),
                ('extraction_gallons', models.DecimalField(blank=True, decimal_places=2, help_text='Extraction converted to gallons', max_digits=15, null=True)),
                ('reading_type', models.CharField(choices=[('manual', 'Manual Reading'), ('ami_automatic', 'AMI Automatic'), ('estimated', 'Estimated'), ('initial', 'Initial Reading'), ('final', 'Final Reading')], default='manual', max_length=20)),
                ('meter_photo', models.ImageField(blank=True, help_text='Photo of meter face showing reading', null=True, upload_to='meter_readings/')),
                ('pump_hours', models.DecimalField(blank=True, decimal_places=2, help_text='Pump runtime hours (if hour meter installed)', max_digits=10, null=True)),
                ('water_level_ft', models.DecimalField(blank=True, decimal_places=2, help_text='Water level at time of reading (ft below surface)', max_digits=7, null=True)),
                ('recorded_by', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('well', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='readings', to='api.well')),
            ],
            options={
                'ordering': ['-reading_date', '-reading_time'],
            },
        ),
        migrations.CreateModel(
            name='WaterAllocation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('water_year', models.CharField(help_text="Water year (e.g., '2024-2025' for Oct 2024 - Sep 2025)", max_length=9)),
                ('period_start', models.DateField()),
                ('period_end', models.DateField()),
                ('allocation_type', models.CharField(choices=[('base', 'Base Allocation'), ('historical', 'Historical Use Allocation'), ('supplemental', 'Supplemental Allocation'), ('carryover', 'Carryover from Previous Year'), ('purchased', 'Purchased (Water Market)'), ('transferred_in', 'Transferred In'), ('transferred_out', 'Transferred Out')], default='base', max_length=20)),
                ('allocated_acre_feet', models.DecimalField(decimal_places=4, help_text='Allocated extraction amount in acre-feet', max_digits=10)),
                ('source', models.CharField(choices=[('gsa', 'GSA Base Allocation'), ('water_market', 'Water Market Purchase'), ('transfer', 'Direct Transfer'), ('recharge_credit', 'Recharge Credit')], default='gsa', max_length=20)),
                ('source_well_id', models.CharField(blank=True, help_text='Source well ID if transferred/purchased', max_length=50)),
                ('transfer_agreement_number', models.CharField(blank=True, help_text='GSA transfer/water market agreement number', max_length=50)),
                ('cost_per_acre_foot', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('total_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('allocation_notice', models.FileField(blank=True, null=True, upload_to='allocation_notices/')),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('well', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='allocations', to='api.well')),
            ],
            options={
                'verbose_name': 'Water Allocation',
                'verbose_name_plural': 'Water Allocations',
                'ordering': ['-water_year', 'well'],
            },
        ),
        migrations.CreateModel(
            name='MeterCalibration',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('calibration_date', models.DateField()),
                ('next_calibration_due', models.DateField(help_text='Typically 3 years from calibration date')),
                ('calibration_type', models.CharField(choices=[('field', 'Field Calibration'), ('shop', 'Shop/Bench Calibration'), ('replacement', 'Meter Replacement'), ('initial', 'Initial Installation')], default='field', max_length=20)),
                ('pre_calibration_accuracy', models.DecimalField(blank=True, decimal_places=2, help_text='Accuracy percentage before calibration', max_digits=6, null=True)),
                ('post_calibration_accuracy', models.DecimalField(blank=True, decimal_places=2, help_text='Accuracy percentage after calibration (must be within +/- 5%)', max_digits=6, null=True)),
                ('passed', models.BooleanField(default=False, help_text='Did calibration meet required accuracy standards?')),
                ('meter_reading_before', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True)),
                ('meter_reading_after', models.DecimalField(blank=True, decimal_places=4, max_digits=15, null=True)),
                ('meter_replaced', models.BooleanField(default=False)),
                ('new_meter_serial', models.CharField(blank=True, help_text='If meter was replaced, new serial number', max_length=100)),
                ('new_meter_make', models.CharField(blank=True, max_length=100)),
                ('new_meter_model', models.CharField(blank=True, max_length=100)),
                ('calibration_company', models.CharField(blank=True, max_length=200)),
                ('technician_name', models.CharField(blank=True, max_length=100)),
                ('technician_license', models.CharField(blank=True, max_length=50)),
                ('technician_phone', models.CharField(blank=True, max_length=20)),
                ('calibration_report', models.FileField(blank=True, help_text='Upload calibration test report PDF', null=True, upload_to='calibration_reports/')),
                ('invoice', models.FileField(blank=True, null=True, upload_to='calibration_invoices/')),
                ('cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('well', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='calibrations', to='api.well')),
            ],
            options={
                'verbose_name': 'Meter Calibration',
                'verbose_name_plural': 'Meter Calibrations',
                'ordering': ['-calibration_date'],
            },
        ),
        migrations.CreateModel(
            name='IrrigationEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('irrigation_date', models.DateField()),
                ('start_time', models.TimeField(blank=True, null=True)),
                ('end_time', models.TimeField(blank=True, null=True)),
                ('duration_hours', models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True)),
                ('measurement_method', models.CharField(choices=[('meter', 'Flowmeter Reading'), ('calculated', 'Calculated (flow rate Ã— time)'), ('estimated', 'Estimated')], default='calculated', max_length=20)),
                ('water_applied_af', models.DecimalField(blank=True, decimal_places=6, help_text='Water applied in acre-feet', max_digits=10, null=True)),
                ('water_applied_gallons', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True)),
                ('acre_inches', models.DecimalField(blank=True, decimal_places=4, help_text='Inches of water applied across field', max_digits=8, null=True)),
                ('irrigation_method', models.CharField(blank=True, choices=[('drip', 'Drip'), ('micro_sprinkler', 'Micro-Sprinkler'), ('sprinkler', 'Sprinkler'), ('flood', 'Flood/Furrow'), ('pivot', 'Center Pivot'), ('hand_water', 'Hand Watering'), ('other', 'Other')], max_length=20)),
                ('zone_or_block', models.CharField(blank=True, help_text='Specific zone or block irrigated', max_length=50)),
                ('acres_irrigated', models.DecimalField(blank=True, decimal_places=2, help_text='Acres irrigated (may be less than total field acres)', max_digits=8, null=True)),
                ('recorded_by', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('field', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='irrigation_events', to='api.field')),
                ('water_source', models.ForeignKey(blank=True, help_text='Use if source is not a well (e.g., surface water)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='irrigation_events', to='api.watersource')),
                ('well', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='irrigation_events', to='api.well')),
            ],
            options={
                'verbose_name': 'Irrigation Event',
                'verbose_name_plural': 'Irrigation Events',
                'ordering': ['-irrigation_date', '-start_time'],
            },
        ),
        migrations.CreateModel(
            name='ExtractionReport',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('period_type', models.CharField(choices=[('semi_annual_1', 'Semi-Annual Period 1 (Oct-Mar)'), ('semi_annual_2', 'Semi-Annual Period 2 (Apr-Sep)'), ('annual', 'Annual (Full Water Year)'), ('monthly', 'Monthly'), ('quarterly', 'Quarterly')], default='semi_annual_1', max_length=20)),
                ('reporting_period', models.CharField(help_text="Period identifier (e.g., '2024-1' for Oct 2023 - Mar 2024)", max_length=20)),
                ('period_start_date', models.DateField()),
                ('period_end_date', models.DateField()),
                ('beginning_meter_reading', models.DecimalField(decimal_places=4, help_text='Meter reading at start of period', max_digits=15)),
                ('beginning_reading_date', models.DateField(blank=True, null=True)),
                ('ending_meter_reading', models.DecimalField(decimal_places=4, help_text='Meter reading at end of period', max_digits=15)),
                ('ending_reading_date', models.DateField(blank=True, null=True)),
                ('total_extraction_native', models.DecimalField(blank=True, decimal_places=4, help_text="Total extraction in meter's native units", max_digits=15, null=True)),
                ('total_extraction_af', models.DecimalField(blank=True, decimal_places=6, help_text='Total extraction in acre-feet', max_digits=12, null=True)),
                ('total_extraction_gallons', models.DecimalField(blank=True, decimal_places=2, max_digits=15, null=True)),
                ('period_allocation_af', models.DecimalField(blank=True, decimal_places=4, help_text='Allocation for this period', max_digits=10, null=True)),
                ('allocation_remaining_af', models.DecimalField(blank=True, decimal_places=4, max_digits=10, null=True)),
                ('over_allocation', models.BooleanField(default=False, help_text='Did extraction exceed allocation?')),
                ('over_allocation_af', models.DecimalField(blank=True, decimal_places=4, help_text='Amount over allocation', max_digits=10, null=True)),
                ('extraction_fee_rate', models.DecimalField(blank=True, decimal_places=4, help_text='Fee rate per acre-foot', max_digits=8, null=True)),
                ('base_extraction_fee', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('surcharge_rate', models.DecimalField(blank=True, decimal_places=4, help_text='Surcharge rate for over-allocation', max_digits=8, null=True)),
                ('surcharge_amount', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('administrative_fee', models.DecimalField(blank=True, decimal_places=2, help_text='Any additional administrative fees', max_digits=10, null=True)),
                ('total_fees_due', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('ready', 'Ready to Submit'), ('submitted', 'Submitted to GSA'), ('confirmed', 'Confirmed by GSA'), ('revision_needed', 'Revision Needed')], default='draft', max_length=20)),
                ('submitted_date', models.DateField(blank=True, null=True)),
                ('gsa_confirmation_number', models.CharField(blank=True, max_length=50)),
                ('gsa_confirmation_date', models.DateField(blank=True, null=True)),
                ('payment_status', models.CharField(choices=[('not_due', 'Not Yet Due'), ('pending', 'Pending'), ('paid', 'Paid'), ('overdue', 'Overdue')], default='not_due', max_length=20)),
                ('payment_due_date', models.DateField(blank=True, null=True)),
                ('payment_date', models.DateField(blank=True, null=True)),
                ('payment_confirmation', models.CharField(blank=True, max_length=100)),
                ('payment_method', models.CharField(blank=True, help_text='Check, ACH, credit card, etc.', max_length=50)),
                ('submitted_report', models.FileField(blank=True, null=True, upload_to='extraction_reports/')),
                ('gsa_receipt', models.FileField(blank=True, null=True, upload_to='extraction_receipts/')),
                ('prepared_by', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('well', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='extraction_reports', to='api.well')),
            ],
            options={
                'verbose_name': 'Extraction Report',
                'verbose_name_plural': 'Extraction Reports',
                'ordering': ['-period_start_date', 'well'],
            },
        ),
        migrations.AddIndex(
            model_name='wellreading',
            index=models.Index(fields=['well', '-reading_date'], name='api_wellrea_well_id_d972dc_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='extractionreport',
            unique_together={('well', 'reporting_period')},
        ),
    ]
